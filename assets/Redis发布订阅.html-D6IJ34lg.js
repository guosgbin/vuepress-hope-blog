import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,b as n,o as a}from"./app-BXgOmWjE.js";const t={};function l(r,e){return a(),i("div",null,e[0]||(e[0]=[n(`<table><thead><tr><th>版本</th><th>内容</th><th>时间</th></tr></thead><tbody><tr><td>V1</td><td>新增</td><td>2023-04-19 01:01:12</td></tr></tbody></table><p>本文参考：</p><ul><li><a href="https://redis.io/docs/manual/pubsub/" target="_blank" rel="noopener noreferrer">https://redis.io/docs/manual/pubsub/</a></li></ul><h2 id="发布订阅概述" tabindex="-1"><a class="header-anchor" href="#发布订阅概述"><span>发布订阅概述</span></a></h2><p>Redis 提供了基于“发布/订阅”模式的消息机制，让客户端（消息发布者）通过广播的方式，将消息同步发送给可能存在的多个客户端（订阅者），并且消息发布的客户端不需要知道接收消息的客户端的具体信息。</p><ul><li><strong>订阅者（subscriber）</strong>：客户端通过订阅特定的频道（channel）来接收发送给该频道的消息；</li><li><strong>发送者（publisher）</strong>：客户端通过向频道（channel）发送消息，传递给对应的订阅者；</li></ul><p><strong>一个频道（channel）可以由任意多个订阅者（subscriber），一个订阅者（subscriber）也可以同时订阅任意多个频道（channel）。</strong></p><p>除了订阅指定的 channel 外，还可以订阅模式（pattern）来接收消息：每当发布者向某个 channel 发送消息的时候，不仅 channel 的订阅者会收到消息，与 channel 匹配的所有模式的订阅者也会收到消息。</p><p>例如现在有一个频道名为 channel.test，订阅者 A 订阅了这个频道，同时订阅者 B 订阅了 channel* 这个频道。假如现在给 channel.test 频道发送消息，订阅者 A 和 B 都会收到消息。</p><h2 id="发布订阅相关的命令" tabindex="-1"><a class="header-anchor" href="#发布订阅相关的命令"><span>发布订阅相关的命令</span></a></h2><table><thead><tr><th>命令</th><th>含义</th><th>使用方式</th></tr></thead><tbody><tr><td>PUBLISH</td><td>向频道发送消息</td><td>PUBLISH channel message</td></tr><tr><td>SUBSCRIBE</td><td>订阅指定频道</td><td>SUBSCRIBE channel [channel ...]</td></tr><tr><td>UNSUBSCRIBE</td><td>取消订阅指定频道<br>无参表示取消订阅所有频道</td><td>UNSUBSCRIBE [channel [channel ...]]</td></tr><tr><td>PSUBSCRIBE</td><td>按照模式订阅</td><td>PSUBSCRIBE pattern [pattern ...]</td></tr><tr><td>PUNSUBSCRIBE</td><td>取消按照模式订阅</td><td>PUNSUBSCRIBE [pattern [pattern ...]]</td></tr><tr><td>PUBSUB CHANNELS</td><td>查看当前订阅的所有频道</td><td>PUBSUB CHANNELS [pattern]</td></tr><tr><td>PUBSUB NUMSUB</td><td>查看给定频道的订阅者数量</td><td>PUBSUB NUMSUB [channel [channel ...]]</td></tr><tr><td>PUBSUB NUMPAT</td><td>查看按照模式订阅的总数量</td><td>PUBSUB NUMPAT</td></tr><tr><td>PUBSUB SHARDCHANNELS</td><td>查看当前的分片频道，<br>7.0.0 版本新增</td><td>PUBSUB SHARDCHANNELS [pattern]</td></tr><tr><td>PUBSUB SHARDNUMSUB</td><td>查看指定分片频道的订阅者数量，<br>7.0.0 版本新增</td><td>PUBSUB SHARDNUMSUB [shardchannel [shardchannel ...]]</td></tr><tr><td>SPUBLISH</td><td>给分片频道发送消息<br>7.0.0 版本新增</td><td>SPUBLISH shardchannel message</td></tr><tr><td>SSUBSCRIBE</td><td>订阅分片频道<br>7.0.0 版本新增</td><td>SSUBSCRIBE shardchannel [shardchannel ...]</td></tr><tr><td>SUNSUBSCRIBE</td><td>取消订阅分片频道<br>7.0.0 版本新增</td><td>SUNSUBSCRIBE [shardchannel [shardchannel ...]]</td></tr></tbody></table><h3 id="简单的发布订阅" tabindex="-1"><a class="header-anchor" href="#简单的发布订阅"><span>简单的发布订阅</span></a></h3><p>开启两个客户端订阅，客户端 A 订阅 test1 频道，客户端 B 订阅 test1 和 test2 频道</p><h4 id="subscribe-订阅消息" tabindex="-1"><a class="header-anchor" href="#subscribe-订阅消息"><span>SUBSCRIBE 订阅消息</span></a></h4><p><strong>客户端订阅一个或多个频道</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>SUBSCRIBE channel [channel ...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>返回值：每次订阅成功一个频道后，都会想执行命令的客户端返回一条订阅信息</p><ol><li>第一个元素：subscribe，表示是 SUBSCRIBE 命令的订阅消息；</li><li>第二个元素：表示被订阅的频道的名字；</li><li>第三个元素：表示当前客户端订阅了多少个频道；</li></ol><p>需要注意的是：一旦客户端进入订阅状态，除开 <code>SUBSCRIBE</code>, <a href="https://redis.io/commands/ssubscribe" target="_blank" rel="noopener noreferrer"><code>SSUBSCRIBE</code></a>, <a href="https://redis.io/commands/psubscribe" target="_blank" rel="noopener noreferrer"><code>PSUBSCRIBE</code></a>, <a href="https://redis.io/commands/unsubscribe" target="_blank" rel="noopener noreferrer"><code>UNSUBSCRIBE</code></a>, <a href="https://redis.io/commands/sunsubscribe" target="_blank" rel="noopener noreferrer"><code>SUNSUBSCRIBE</code></a>, <a href="https://redis.io/commands/punsubscribe" target="_blank" rel="noopener noreferrer"><code>PUNSUBSCRIBE</code></a>, <a href="https://redis.io/commands/ping" target="_blank" rel="noopener noreferrer"><code>PING</code></a>, <a href="https://redis.io/commands/reset" target="_blank" rel="noopener noreferrer"><code>RESET</code></a> 和 <a href="https://redis.io/commands/quit" target="_blank" rel="noopener noreferrer"><code>QUIT</code></a> 命令，其它命令都不接受。</p><blockquote><p>但是，如果使用 RESP3（请参阅 HELLO 命令），则客户端可以在订阅状态下发出任何命令。</p><p><a href="https://redis.io/commands/hello/" target="_blank" rel="noopener noreferrer">https://redis.io/commands/hello/</a></p><p><code>&gt;= 6.2.0</code>: <a href="https://redis.io/commands/reset" target="_blank" rel="noopener noreferrer"><code>RESET</code></a> can be called to exit subscribed state.</p></blockquote><p>客户端 A 订阅 test1 频道</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; SUBSCRIBE test1</span></span>
<span class="line"><span>Reading messages... (press Ctrl-C to quit)</span></span>
<span class="line"><span>1) &quot;subscribe&quot;</span></span>
<span class="line"><span>2) &quot;test1&quot;</span></span>
<span class="line"><span>3) (integer) 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>客户端 B 订阅 test1 和 test2 频道</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; SUBSCRIBE test1 test2</span></span>
<span class="line"><span>Reading messages... (press Ctrl-C to quit)</span></span>
<span class="line"><span>1) &quot;subscribe&quot;</span></span>
<span class="line"><span>2) &quot;test1&quot;</span></span>
<span class="line"><span>3) (integer) 1</span></span>
<span class="line"><span>1) &quot;subscribe&quot;</span></span>
<span class="line"><span>2) &quot;test2&quot;</span></span>
<span class="line"><span>3) (integer) 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="publish-发布消息" tabindex="-1"><a class="header-anchor" href="#publish-发布消息"><span>PUBLISH 发布消息</span></a></h4><p>客户端发布消息到频道</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>SUBSCRIBE channel [channel ...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>返回值：<strong>命令的返回值表示有多少个订阅者接收到了这条消息。</strong></p><p>TODO-KWOK 集群模式的限制</p><p>开启一个新的客户端给 test1 通道发消息：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; PUBLISH test1 hello-test1</span></span>
<span class="line"><span>(integer) 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>客户端 A 的情况，接收到了消息</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; SUBSCRIBE test1 test2</span></span>
<span class="line"><span>Reading messages... (press Ctrl-C to quit)</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>1) &quot;message&quot;</span></span>
<span class="line"><span>2) &quot;test1&quot;</span></span>
<span class="line"><span>3) &quot;hello-test1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>客户端 B 的情况，接收到了消息</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; SUBSCRIBE test1</span></span>
<span class="line"><span>Reading messages... (press Ctrl-C to quit)</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>1) &quot;message&quot;</span></span>
<span class="line"><span>2) &quot;test1&quot;</span></span>
<span class="line"><span>3) &quot;hello-test1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>接收频道消息的信息</strong></p><ol><li>第一个元素：message，表明该消息是一个频道消息；</li><li>第二个元素：表示消息来自于那个频道；</li><li>第三个元素：表示真正的消息内容；</li></ol><p>发布者给 test2 发消息，只会有客户端 B 接收到消息，可自行测试。</p><h4 id="unsubscribe-取消订阅频道" tabindex="-1"><a class="header-anchor" href="#unsubscribe-取消订阅频道"><span>UNSUBSCRIBE 取消订阅频道</span></a></h4><p><strong>取消订阅给定频道，如果没有给定频道名称，则取消订阅以前订阅的所有频道。</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>UNSUBSCRIBE [channel [channel ...]]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>返回值：</p><ol><li>第一个元素：unsubscribe，表面该消息是一条取消订阅的消息；</li><li>第二个元素：表示取消订阅频道的名字；</li><li>第三个元素：表示客户端在执行取消订阅操作后，目前仍在订阅的频道数量；</li></ol><p>新开一个客户端，取消订阅 test1 频道（为什么新开客户端，后面会说）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; UNSUBSCRIBE test1</span></span>
<span class="line"><span>1) &quot;unsubscribe&quot;</span></span>
<span class="line"><span>2) &quot;test1&quot;</span></span>
<span class="line"><span>3) (integer) 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意的是，虽然 Redis 提供了 UNSUBSCRIBE 命令来取消订阅频道，但是 <strong>Redis 各个客户端对 Pub/Sub 功能的支持方式并不相同，所以并非所有客户端都能使用 UNSUBSCRIBE 来执行取消订阅操作</strong>。例如 Redis 自带的 redis-cli 客户端在执行 SUBSCRIBE 命令之后就会进入阻塞状态，无法再执行其他命令，用户只能 Ctrl-C 退出 redis-cli，所以 redis-cli 客户端并不支持使用 UNSUBSCRIBE 命令。</p><h3 id="按照模式订阅" tabindex="-1"><a class="header-anchor" href="#按照模式订阅"><span>按照模式订阅</span></a></h3><h4 id="psubscribe-订阅消息" tabindex="-1"><a class="header-anchor" href="#psubscribe-订阅消息"><span>PSUBSCRIBE 订阅消息</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PSUBSCRIBE pattern [pattern ...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>按照模式订阅，支持 glob-style 匹配</p><ul><li><code>h?llo</code>，会订阅 <code>hello</code>, <code>hallo</code> 和 <code>hxllo</code> 频道；</li><li><code>h*llo</code> ，会订阅 <code>hllo</code> 和 <code>heeeello</code> 频道；</li><li><code>h[ae]llo</code> ，会订阅 <code>hello</code> 和 <code>hallo</code>频道 ，但是不会 <code>hillo</code> 频道；</li></ul><p>需要注意的是：一旦客户端进入订阅状态，除开 <code>SUBSCRIBE</code>, <a href="https://redis.io/commands/ssubscribe" target="_blank" rel="noopener noreferrer"><code>SSUBSCRIBE</code></a>, <a href="https://redis.io/commands/psubscribe" target="_blank" rel="noopener noreferrer"><code>PSUBSCRIBE</code></a>, <a href="https://redis.io/commands/unsubscribe" target="_blank" rel="noopener noreferrer"><code>UNSUBSCRIBE</code></a>, <a href="https://redis.io/commands/sunsubscribe" target="_blank" rel="noopener noreferrer"><code>SUNSUBSCRIBE</code></a>, <a href="https://redis.io/commands/punsubscribe" target="_blank" rel="noopener noreferrer"><code>PUNSUBSCRIBE</code></a>, <a href="https://redis.io/commands/ping" target="_blank" rel="noopener noreferrer"><code>PING</code></a>, <a href="https://redis.io/commands/reset" target="_blank" rel="noopener noreferrer"><code>RESET</code></a> 和 <a href="https://redis.io/commands/quit" target="_blank" rel="noopener noreferrer"><code>QUIT</code></a> 命令，其它命令都不接受。</p><p>新开一个客户端订阅模式 <code>test*</code></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; PSUBSCRIBE test*</span></span>
<span class="line"><span>Reading messages... (press Ctrl-C to quit)</span></span>
<span class="line"><span>1) &quot;psubscribe&quot;</span></span>
<span class="line"><span>2) &quot;test*&quot;</span></span>
<span class="line"><span>3) (integer) 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>返回值：</p><ul><li>第一个元素：psubscribe，表明消息是是由 PSUBSCRIBE 发起的一个订阅消息；</li><li>第二个元素：被订阅的模式；</li><li>第三个元素：客户端目前订阅模式的数量；</li></ul><p>此时另一个客户端发送给 test1 频道发送一个消息，当前客户端会接收到消息</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; PSUBSCRIBE test*</span></span>
<span class="line"><span>Reading messages... (press Ctrl-C to quit)</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>1) &quot;pmessage&quot;</span></span>
<span class="line"><span>2) &quot;test*&quot;</span></span>
<span class="line"><span>3) &quot;test2&quot;</span></span>
<span class="line"><span>4) &quot;hello-test-pattern&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>返回值：</p><ul><li>第一个元素：pmessage，表示这是一条模式消息而不是订阅消息或频道消息；</li><li>第二个元素：被匹配的模式；</li><li>第三个元素：与模式相匹配的频道；</li><li>第四个元素：消息的内容；</li></ul><blockquote><ul><li><code>&gt;= 6.2.0</code>: <a href="https://redis.io/commands/reset" target="_blank" rel="noopener noreferrer"><code>RESET</code></a> can be called to exit subscribed state.</li></ul></blockquote><h4 id="unsubscribe-取消订阅消息" tabindex="-1"><a class="header-anchor" href="#unsubscribe-取消订阅消息"><span>UNSUBSCRIBE 取消订阅消息</span></a></h4><p>取消订阅给定模式，无参表示取消订阅所有模式。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PUNSUBSCRIBE [pattern [pattern ...]]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>和 UNSUBSCRIBE 命令一样，<strong>Redis 各个客户端对 Pub/Sub 功能的支持方式并不相同，所以并非所有客户端都能使用 PUNSUBSCRIBE 来执行取消订阅模式操作</strong>。例如 Redis 自带的 redis-cli 客户端在执行 PSUBSCRIBE 命令之后就会进入阻塞状态，无法再执行其他命令，用户只能 Ctrl-C 退出 redis-cli，所以 redis-cli 客户端并不支持使用 PUNSUBSCRIBE 命令。</p><p>UNSUBSCRIBE 命令的返回值</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; PUNSUBSCRIBE test*</span></span>
<span class="line"><span>1) &quot;punsubscribe&quot;</span></span>
<span class="line"><span>2) &quot;test*&quot;</span></span>
<span class="line"><span>3) (integer) 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>返回值：</p><ul><li>第一个元素：punsubscribe，表明该消息是 PUNSUBSCRIBE 命令的一个取消订阅模式的消息；</li><li>第二个元素：被取消订阅的模式；</li><li>第三个元素：客户端在执行当前取消订阅的操作后，仍在订阅的模式数量；</li></ul><h3 id="pubsub-查看发布订阅的相关信息" tabindex="-1"><a class="header-anchor" href="#pubsub-查看发布订阅的相关信息"><span>PUBSUB 查看发布订阅的相关信息</span></a></h3><h4 id="pubsub-channels-查看订阅的频道" tabindex="-1"><a class="header-anchor" href="#pubsub-channels-查看订阅的频道"><span>PUBSUB CHANNELS 查看订阅的频道</span></a></h4><p>列出目前被订阅的所有频道，如果给定了可选的 pattern 参数，那么只会列出与给定 pattern 匹配的频道。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PUBSUB CHANNELS [pattern]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; pubsub channels</span></span>
<span class="line"><span>1) &quot;test2&quot;</span></span>
<span class="line"><span>2) &quot;test1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TODO-KWOK 集群问题</p><h4 id="pubsub-numsub-查看频道的订阅者数量" tabindex="-1"><a class="header-anchor" href="#pubsub-numsub-查看频道的订阅者数量"><span>PUBSUB NUMSUB 查看频道的订阅者数量</span></a></h4><p>查看任意多个频道的订阅者数量（不包括订阅模式的客户端）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PUBSUB NUMSUB [channel [channel ...]]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; pubsub numsub test1 test2</span></span>
<span class="line"><span>1) &quot;test1&quot;</span></span>
<span class="line"><span>2) (integer) 2</span></span>
<span class="line"><span>3) &quot;test2&quot;</span></span>
<span class="line"><span>4) (integer) 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TODO-KWOK 集群问题</p><h4 id="pubsub-numpat-查看订阅模式的总数量" tabindex="-1"><a class="header-anchor" href="#pubsub-numpat-查看订阅模式的总数量"><span>PUBSUB NUMPAT 查看订阅模式的总数量</span></a></h4><p>查看当前被订阅模式的总数量（使用 PSUBSCRIBE 命令执行）。请注意，这不是订阅模式的客户端数量，而是所有客户端订阅的唯一模式的总数。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PUBSUB NUMPAT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; pubsub numpat</span></span>
<span class="line"><span>(integer) 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="同时匹配模式和频道订阅的问题" tabindex="-1"><a class="header-anchor" href="#同时匹配模式和频道订阅的问题"><span>同时匹配模式和频道订阅的问题</span></a></h3><p>如果客户端订阅了与已发布消息匹配的多个模式，或者如果它订阅了与消息匹配的模式和通道，则客户端可能会多次收到同一条消息。</p><ul><li>如果订阅者订阅了多个与发布消息的频道匹配的模式，客户端可能会多次收到同一条消息；</li><li>如果订阅者订阅了一个频道，又订阅了一个匹配这个频道的模式，客户端可能会多次收到同一条消息；</li></ul><p>例如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>SUBSCRIBE foo</span></span>
<span class="line"><span>PSUBSCRIBE f*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的示例中，如果将消息发送到频道 foo，则客户端将收到两条消息：一条是 message 类型，一条是 pmessage 类型。</p>`,90)]))}const c=s(t,[["render",l]]),o=JSON.parse('{"path":"/Redis/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.html","title":"Redis发布订阅","lang":"en-US","frontmatter":{"title":"Redis发布订阅","description":"本文参考： https://redis.io/docs/manual/pubsub/ 发布订阅概述 Redis 提供了基于“发布/订阅”模式的消息机制，让客户端（消息发布者）通过广播的方式，将消息同步发送给可能存在的多个客户端（订阅者），并且消息发布的客户端不需要知道接收消息的客户端的具体信息。 订阅者（subscriber）：客户端通过订阅特定的频道...","head":[["meta",{"property":"og:url","content":"https://blog.guosgbin.cn/Redis/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.html"}],["meta",{"property":"og:title","content":"Redis发布订阅"}],["meta",{"property":"og:description","content":"本文参考： https://redis.io/docs/manual/pubsub/ 发布订阅概述 Redis 提供了基于“发布/订阅”模式的消息机制，让客户端（消息发布者）通过广播的方式，将消息同步发送给可能存在的多个客户端（订阅者），并且消息发布的客户端不需要知道接收消息的客户端的具体信息。 订阅者（subscriber）：客户端通过订阅特定的频道..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-04-03T07:07:29.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-03T07:07:29.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis发布订阅\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-04-03T07:07:29.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"超威蓝猫 Dylan Kwok\\",\\"url\\":\\"\\",\\"email\\":\\"guosgbin@163.com\\"}]}"]]},"git":{"createdTime":1743664049000,"updatedTime":1743664049000,"contributors":[{"name":"Dylan Kwok","username":"","email":"guosgbin@163.com","commits":1}]},"readingTime":{"minutes":7.95,"words":2386},"filePathRelative":"Redis/Redis发布订阅.md","localizedDate":"April 3, 2025","autoDesc":true}');export{c as comp,o as data};
