<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.78" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://blog.guosgbin.cn/Redis/Redis%E5%A4%8D%E5%88%B6.html"><meta property="og:title" content="Rediså¤åˆ¶"><meta property="og:description" content="æœ¬æ–‡å†…å®¹æ¥è‡ª https://redis.io/docs/management/replication/ ã€ŠRedis ä½¿ç”¨æ‰‹å†Œã€‹ -- å¯ä»¥ ã€ŠRedis å¼€å‘å’Œè¿ç»´ã€‹-- å¾ˆæ£’ ã€ŠRedis æ·±åº¦å†é™©ã€‹ -- å»ºè®®ä¸çœ‹è¿™ä¸ª Redis å¤åˆ¶ Redis æä¾›äº†å¤åˆ¶åŠŸèƒ½ï¼Œ å®ç°äº†ç›¸åŒæ•°æ®çš„å¤šä¸ª Redis å‰¯æœ¬ï¼Œ å¤åˆ¶åŠŸèƒ½æ˜¯é«˜å¯ç”¨ Redis çš„åŸºç¡€..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2025-04-03T07:07:29.000Z"><meta property="article:modified_time" content="2025-04-03T07:07:29.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Rediså¤åˆ¶","image":[""],"dateModified":"2025-04-03T07:07:29.000Z","author":[{"@type":"Person","name":"è¶…å¨è“çŒ« Dylan Kwok","url":"","email":"guosgbin@163.com"}]}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+Mono+TC" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC" rel="stylesheet"><link rel="icon" href="/å°ç†ŠçŒ«.svg"><title>Rediså¤åˆ¶</title><meta name="description" content="æœ¬æ–‡å†…å®¹æ¥è‡ª https://redis.io/docs/management/replication/ ã€ŠRedis ä½¿ç”¨æ‰‹å†Œã€‹ -- å¯ä»¥ ã€ŠRedis å¼€å‘å’Œè¿ç»´ã€‹-- å¾ˆæ£’ ã€ŠRedis æ·±åº¦å†é™©ã€‹ -- å»ºè®®ä¸çœ‹è¿™ä¸ª Redis å¤åˆ¶ Redis æä¾›äº†å¤åˆ¶åŠŸèƒ½ï¼Œ å®ç°äº†ç›¸åŒæ•°æ®çš„å¤šä¸ª Redis å‰¯æœ¬ï¼Œ å¤åˆ¶åŠŸèƒ½æ˜¯é«˜å¯ç”¨ Redis çš„åŸºç¡€...">
    <link rel="preload" href="/assets/style-DJJ2bZ_d.css" as="style"><link rel="stylesheet" href="/assets/style-DJJ2bZ_d.css">
    <link rel="modulepreload" href="/assets/app-DePq4ozi.js"><link rel="modulepreload" href="/assets/Rediså¤åˆ¶.html--dEfNmHI.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-D1HmjPqT.js" as="script"><link rel="prefetch" href="/assets/01-åˆ›å»ºå’Œé”€æ¯å¯¹è±¡.html-za7Rq9t9.js" as="script"><link rel="prefetch" href="/assets/01-CASå’ŒUnsafeçš„APIåˆ†æ.html-D7_-nKyZ.js" as="script"><link rel="prefetch" href="/assets/02-åŸºæœ¬ç±»å‹åŸå­ç±»AtomicLong.html-CT9B_KQD.js" as="script"><link rel="prefetch" href="/assets/03-å¼•ç”¨ç±»å‹åŸå­ç±»AtomicReference.html-2ZDOFh8S.js" as="script"><link rel="prefetch" href="/assets/04-åŸå­æ•°ç»„ç±»AtomicLongArray.html-BwlBIJ2V.js" as="script"><link rel="prefetch" href="/assets/05-åŸå­æ“ä½œç±»AtomicReferenceFieldUpdater.html-BvhP96qA.js" as="script"><link rel="prefetch" href="/assets/06-é«˜æ€§èƒ½åŸå­ç±»LongAdder.html-CYQiMKcc.js" as="script"><link rel="prefetch" href="/assets/07-LockSupportåˆ†æ.html-TxRVj4NN.js" as="script"><link rel="prefetch" href="/assets/08-AQSç®€å•ä»‹ç».html-COeHvPgu.js" as="script"><link rel="prefetch" href="/assets/09-åŸºäºReentrantLockåˆ†æAQSçš„ç‹¬å æ¨¡å¼.html-gB97kukz.js" as="script"><link rel="prefetch" href="/assets/10-åŸºäºCountDownLatchåˆ†æAQSçš„å…±äº«æ¨¡å¼.html-BSgtSlKk.js" as="script"><link rel="prefetch" href="/assets/11-AQSçš„Conditionæœºåˆ¶.html-DoJPW2JL.js" as="script"><link rel="prefetch" href="/assets/12-ä¿¡å·é‡Semaphore.html-BaxBmpB0.js" as="script"><link rel="prefetch" href="/assets/13-å¾ªç¯æ æ …CyclicBarrier.html-CChYlnwq.js" as="script"><link rel="prefetch" href="/assets/14-é˜¶æ®µPhaser.html-bDXiLTfp.js" as="script"><link rel="prefetch" href="/assets/15-äº¤æ¢Exchanger.html-CPUG-B9R.js" as="script"><link rel="prefetch" href="/assets/16-è¯»å†™é”ReentrantReadWriteLock.html-CF4d47GW.js" as="script"><link rel="prefetch" href="/assets/17-Futureæ¨¡å¼-FutureTask.html-CD14B1MX.js" as="script"><link rel="prefetch" href="/assets/18-çº¿ç¨‹æ± ä½“ç³»æ¦‚è¿°.html-CSxUPt7i.js" as="script"><link rel="prefetch" href="/assets/19-çº¿ç¨‹æ± ä½“ç³»-AbstractExecutorService.html-BTVWwFED.js" as="script"><link rel="prefetch" href="/assets/20-çº¿ç¨‹æ± ä½“ç³»-ThreadPoolExecutor.html-w--r1gG1.js" as="script"><link rel="prefetch" href="/assets/21-çº¿ç¨‹æ± ä½“ç³»-ScheduledThreadPoolExecutor.html-DLmdzmRE.js" as="script"><link rel="prefetch" href="/assets/22-CopyOnWriteArrayListå†™æ—¶å¤åˆ¶.html-tZiVCmhK.js" as="script"><link rel="prefetch" href="/assets/23-CopyOnWriteArraySetå†™æ—¶å¤åˆ¶.html-C-9CsPHr.js" as="script"><link rel="prefetch" href="/assets/24-ConcurrentSkipListMapè·³è¡¨.html-B-B7-dI0.js" as="script"><link rel="prefetch" href="/assets/25-ConcurrentSkipListSetè·³è¡¨.html-dxao2NJN.js" as="script"><link rel="prefetch" href="/assets/26-ConcurrentHashMapæºç åˆ†æ.html-X6bRvtii.js" as="script"><link rel="prefetch" href="/assets/27-é˜»å¡é˜Ÿåˆ—ArrayBlockingQueue.html-CWPvXDWG.js" as="script"><link rel="prefetch" href="/assets/28-é˜»å¡é˜Ÿåˆ—LinkedBlockingQueue.html-BOlydIar.js" as="script"><link rel="prefetch" href="/assets/29-é˜»å¡é˜Ÿåˆ—LinkedBlockingDeque.html-CcEC12oH.js" as="script"><link rel="prefetch" href="/assets/30-é˜»å¡é˜Ÿåˆ—PriorityBlockingQueue.html-hq_bYE6V.js" as="script"><link rel="prefetch" href="/assets/31-é˜»å¡é˜Ÿåˆ—DelayQueue.html-qbfwdVgH.js" as="script"><link rel="prefetch" href="/assets/32-é˜»å¡é˜Ÿåˆ—SynchronousQueue.html-DlMdaYXV.js" as="script"><link rel="prefetch" href="/assets/33-é˜»å¡é˜Ÿåˆ—LinkedTransferQueue.html-CesxTGMH.js" as="script"><link rel="prefetch" href="/assets/SPIæœºåˆ¶.html-CXjug_AB.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis01ï¼šmyabtisçš„æ•´ä½“æ¶æ„.html-Cyo-qyMq.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis02ï¼šå…¥é—¨æ¡ˆä¾‹.html-hgmnjGS7.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis03ï¼šè§£æå…¨å±€é…ç½®æ–‡ä»¶.html-DA07cOym.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis04ï¼šè§£æMapperæ˜ å°„æ–‡ä»¶.html-C9zZIHoj.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis05ï¼šè§£æStatementæ“ä½œèŠ‚ç‚¹.html-CI306zEc.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis06ï¼šè§£æSQLè¯­å¥.html-C-xjsm_A.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis07ï¼šJavaæ–¹æ³•å’ŒSQLè¯­å¥ç»‘å®š.html-DA6OxU3M.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis08ï¼šè·å¾—SqlSession.html-Kqj0IkE_.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis09ï¼šExecutoræ‰§è¡Œå™¨.html-HtA5pde4.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis10ï¼šç¼“å­˜æœºåˆ¶.html-VJpoBtTb.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis11ï¼šStatementHandler.html-87UW8wSn.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis12ï¼šå‚æ•°è§£æå’Œèµ‹å€¼.html-BllyKkzs.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis13ï¼šç»“æœé›†å¤„ç†.html-COvWCOFb.js" as="script"><link rel="prefetch" href="/assets/æ·±å…¥æµ…å‡ºMybatis14ï¼šæ’ä»¶.html-xYVtHD7D.js" as="script"><link rel="prefetch" href="/assets/01-æœåŠ¡ç«¯å¯åŠ¨æµç¨‹.html-Qol3UnA5.js" as="script"><link rel="prefetch" href="/assets/02-æœåŠ¡ç«¯å¯åŠ¨æ·»åŠ ChannelInitializeråˆ°ç®¡é“.html-BGpIEWFt.js" as="script"><link rel="prefetch" href="/assets/03-å®¢æˆ·ç«¯å¯åŠ¨æµç¨‹.html-b1GKbTf3.js" as="script"><link rel="prefetch" href="/assets/04-çº¿ç¨‹ä½“ç³»-NioEventLoopGroup.html-DWYnb9H_.js" as="script"><link rel="prefetch" href="/assets/05-çº¿ç¨‹ä½“ç³»-NioEventLoopç›¸å…³çˆ¶æ¥å£åˆ†æ.html-BxjCKZ_K.js" as="script"><link rel="prefetch" href="/assets/06-çº¿ç¨‹ä½“ç³»-AbstractEventExecutor.html-CRN77ma4.js" as="script"><link rel="prefetch" href="/assets/07-çº¿ç¨‹ä½“ç³»-AbstractScheduledEventExecutor-ä¼˜å…ˆé˜Ÿåˆ—.html--3kClJm0.js" as="script"><link rel="prefetch" href="/assets/08-çº¿ç¨‹ä½“ç³»-NioEventLoopæ¦‚è¿°.html-BUfOTwyr.js" as="script"><link rel="prefetch" href="/assets/09-çº¿ç¨‹ä½“ç³»-NioEventLoopå¼€å¯SelectoråŠä¼˜åŒ–.html-Br_zHykT.js" as="script"><link rel="prefetch" href="/assets/10-çº¿ç¨‹ä½“ç³»-NioEventLoopç»‘å®šçº¿ç¨‹.html-80UBKJwu.js" as="script"><link rel="prefetch" href="/assets/11-çº¿ç¨‹ä½“ç³»-NioEventLoopçš„runæ–¹æ³•.html-Bh4gI4TM.js" as="script"><link rel="prefetch" href="/assets/12-çº¿ç¨‹ä½“ç³»-NioEventLoopè§„é¿JDKçš„NIOç©ºå¾ªç¯bug.html-B8wT-PcJ.js" as="script"><link rel="prefetch" href="/assets/13-çº¿ç¨‹ä½“ç³»-NioEventLoopçš„ä¼˜é›…å…³é—­.html-Cre3sGhq.js" as="script"><link rel="prefetch" href="/assets/14-æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥(ACCEPT).html-B0kW1esk.js" as="script"><link rel="prefetch" href="/assets/15-å®¢æˆ·ç«¯å¤„ç†READäº‹ä»¶æ¦‚è¿°.html-D6QEuCXf.js" as="script"><link rel="prefetch" href="/assets/16-å®¢æˆ·ç«¯å¤„ç†READäº‹ä»¶è¯¦è§£åŠRecvByteBufAllocator.html-B2mkAJ5Y.js" as="script"><link rel="prefetch" href="/assets/17-Nettyç®¡é“æœºåˆ¶.html-pBcUWIZs.js" as="script"><link rel="prefetch" href="/assets/18-Nettyå‘é€æ•°æ®æµç¨‹åŠå‡ºç«™ç¼“å†²åŒº.html-DFIYAeqI.js" as="script"><link rel="prefetch" href="/assets/Redis_BenchmarkåŸºå‡†æµ‹è¯•.html-DlyQidb2.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤å’Œæ§½ç®¡ç†å‘½ä»¤.html-BCUPKiu7.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤åŸºæœ¬ç‰¹æ€§å’Œé›†ç¾¤æ­å»º.html-C1sMW2FW.js" as="script"><link rel="prefetch" href="/assets/Redis_Clusteré›†ç¾¤ç®¡ç†å·¥å…·redis-cli.html-C3LRy12f.js" as="script"><link rel="prefetch" href="/assets/Redis_Pipelineä¼˜åŒ–RTT.html-CgZcTFRz.js" as="script"><link rel="prefetch" href="/assets/Redis_Sentinelé«˜å¯ç”¨.html-ZUnP6Ivg.js" as="script"><link rel="prefetch" href="/assets/Redis_keyè®¾è®¡è§„èŒƒ.html-sYrnOGp9.js" as="script"><link rel="prefetch" href="/assets/Redisäº‹åŠ¡.html-BmZp19sR.js" as="script"><link rel="prefetch" href="/assets/Rediså†…å­˜æ·˜æ±°ç­–ç•¥.html-x-qyeKrA.js" as="script"><link rel="prefetch" href="/assets/Rediså‘å¸ƒè®¢é˜….html-BrnW-uLq.js" as="script"><link rel="prefetch" href="/assets/Rediså¤§keyå’Œçƒ­keyé—®é¢˜.html-BOPGpsKU.js" as="script"><link rel="prefetch" href="/assets/Redisæ…¢æŸ¥è¯¢æ—¥å¿—.html-ChXb7lGL.js" as="script"><link rel="prefetch" href="/assets/RedisæŒä¹…åŒ–æœºåˆ¶.html-DLAOXhY2.js" as="script"><link rel="prefetch" href="/assets/Redisé”®ç©ºé—´é€šçŸ¥(keyspace notification).html-CgYBhLR7.js" as="script"><link rel="prefetch" href="/assets/redis-cli ä½¿ç”¨.html-DHQHG_5W.js" as="script"><link rel="prefetch" href="/assets/01-RocketMQæ¦‚è¿°.html-C--qt7nU.js" as="script"><link rel="prefetch" href="/assets/02-NameServerå¯åŠ¨æµç¨‹.html-BEQg38-C.js" as="script"><link rel="prefetch" href="/assets/03-Brokerå¯åŠ¨æµç¨‹.html-C_PND05M.js" as="script"><link rel="prefetch" href="/assets/04-RocketMQç½‘ç»œé€šä¿¡åŸç†.html-BMP1JgK3.js" as="script"><link rel="prefetch" href="/assets/05-RocketMQ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å¯åŠ¨.html-DgiBjG-e.js" as="script"><link rel="prefetch" href="/assets/06-RocketMQç½‘ç»œé€šä¿¡æºç .html-CH82Z-vY.js" as="script"><link rel="prefetch" href="/assets/07-NameServerä½œç”¨å’Œè·¯ç”±å…ƒä¿¡æ¯.html-BiKXE6fK.js" as="script"><link rel="prefetch" href="/assets/08-NameServerè·¯ç”±ç®¡ç†æºç åˆ†æ.html-6ls3ELB_.js" as="script"><link rel="prefetch" href="/assets/09-ç”Ÿäº§è€…ç›¸å…³ç±»åˆ†æ.html-BB4Uiggw.js" as="script"><link rel="prefetch" href="/assets/10-ç”Ÿäº§è€…å¯åŠ¨æµç¨‹.html-B0fImC9N.js" as="script"><link rel="prefetch" href="/assets/11-ç”Ÿäº§è€…å‘é€æ¶ˆæ¯.html-CZYyH-hB.js" as="script"><link rel="prefetch" href="/assets/12-Brokerå­˜å‚¨æœºåˆ¶æ¦‚è¿°.html-BROwZohm.js" as="script"><link rel="prefetch" href="/assets/13-MappedFileå’ŒMappedFileQueueåˆ†æ.html-CIyinEg4.js" as="script"><link rel="prefetch" href="/assets/14-CommitLogåŸç†åˆ†æ.html-BDqMvbR0.js" as="script"><link rel="prefetch" href="/assets/15-brokerçš„åˆ·ç›˜æœºåˆ¶.html-Bfq9IF7I.js" as="script"><link rel="prefetch" href="/assets/16-ConsumeQueueå’ŒIndexåŸç†åˆ†æ.html-CjbS_9a_.js" as="script"><link rel="prefetch" href="/assets/17-brokerè¿‡æœŸæ–‡ä»¶åˆ é™¤æœºåˆ¶.html-DPl194wx.js" as="script"><link rel="prefetch" href="/assets/18-æ¶ˆè´¹è€…å¯åŠ¨æµç¨‹(TODO).html-DrraF0dB.js" as="script"><link rel="prefetch" href="/assets/19-æ¶ˆæ¯æ‹‰å–å…¥å£å’Œæ¶ˆæ¯é˜Ÿåˆ—è´Ÿè½½å‡è¡¡.html-KCpw0Dkp.js" as="script"><link rel="prefetch" href="/assets/20-æ¶ˆè´¹è€…å‘é€æ¶ˆæ¯æ‹‰å–è¯·æ±‚æµç¨‹.html-CJI3BXNK.js" as="script"><link rel="prefetch" href="/assets/21-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-1-ä¸»æµç¨‹.html-bHjQcoC-.js" as="script"><link rel="prefetch" href="/assets/22-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-2-é•¿è½®è¯¢.html-Dcm7fqpu.js" as="script"><link rel="prefetch" href="/assets/23-brokerå¤„ç†æ¶ˆæ¯æ‹‰å–è¯·æ±‚-3-è¯»å–æ¶ˆæ¯.html-BVKwrhy_.js" as="script"><link rel="prefetch" href="/assets/24-æ¶ˆè´¹è€…å¤„ç†ä»brokeræ‹‰å–çš„æ¶ˆæ¯.html-M0cE4FUi.js" as="script"><link rel="prefetch" href="/assets/25-å¹¶å‘æ¶ˆè´¹åŸç†.html-BYgosR01.js" as="script"><link rel="prefetch" href="/assets/001-æœåŠ¡å™¨CPUé—®é¢˜-è§„å¾‹æ€§å³°åˆº.html-CflYhTY1.js" as="script"><link rel="prefetch" href="/assets/002-æœåŠ¡å™¨CPUé…ç½®é™ä½GCåˆ†æ.html-93lAcWMA.js" as="script"><link rel="prefetch" href="/assets/003-æœåŠ¡å™¨CPUä½¿ç”¨ç‡è¾ƒä½ä½†ç³»ç»Ÿè´Ÿè½½é«˜.html-ByzbbQfh.js" as="script"><link rel="prefetch" href="/assets/004-log4j2å†…å­˜æ³„éœ²å¯¼è‡´çš„é¢‘ç¹fullgc.html-UJVb05Fj.js" as="script"><link rel="prefetch" href="/assets/005-çº¿ç¨‹æ± çˆ¶å­ä»»åŠ¡ä½¿ç”¨ä¸å½“é€ æˆæ­»é”.html-CqkfEM7S.js" as="script"><link rel="prefetch" href="/assets/006-linuxç³»ç»Ÿå‚æ•°-è¿æ¥é˜Ÿåˆ—é•¿åº¦è¿‡å°å¯¼è‡´è¿æ¥ä¸¢å¼ƒ.html-ZMzPyE1s.js" as="script"><link rel="prefetch" href="/assets/007-redisé¢‘ç¹æ·˜æ±°-æ¸…é™¤redisçº¿ä¸Šæœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„key.html-nXPS9TZR.js" as="script"><link rel="prefetch" href="/assets/008-JVMå †å¤–å†…å­˜æ³„éœ²æ’æŸ¥.html-C2BmNK-E.js" as="script"><link rel="prefetch" href="/assets/IMå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±.html-muGarKkc.js" as="script"><link rel="prefetch" href="/assets/ç»éªŒ-æŸ¥è¯¢ç±»æ¥å£è¶…æ—¶ä¼˜åŒ–æŠ€å·§.html-DlPCle6Y.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®-IMé•¿è¿æ¥ä¼˜åŒ–.html-Din5yjW4.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®-æœåŠ¡é™çº§.html-DFO77xo1.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®-ç›´æ’­é—´ä¸šåŠ¡å¤šçº§ç¼“å­˜ä¼˜åŒ–.html-RgboFAb2.js" as="script"><link rel="prefetch" href="/assets/é¡¹ç›®-çº¿ç¨‹æ± ä¼˜åŒ–.html-IwlzhNIo.js" as="script"><link rel="prefetch" href="/assets/JUCç›¸å…³é—®é¢˜.html-DAT-dsXj.js" as="script"><link rel="prefetch" href="/assets/JVMé—®é¢˜.html-YgXjc1Et.js" as="script"><link rel="prefetch" href="/assets/MySQLç›¸å…³é—®é¢˜.html-Dqnw1WbM.js" as="script"><link rel="prefetch" href="/assets/Redisç›¸å…³é—®é¢˜.html-Dz105oz8.js" as="script"><link rel="prefetch" href="/assets/äºŒåˆ†æŸ¥æ‰¾.html-C0iAN8k_.js" as="script"><link rel="prefetch" href="/assets/äºŒå‰æ ‘.html-B6AdSlqr.js" as="script"><link rel="prefetch" href="/assets/ä»£ç éšæƒ³å½•é¢˜ç›®ç›®å½•.html-DkAWzICQ.js" as="script"><link rel="prefetch" href="/assets/HowToSayResume.html-CbfLbw-t.js" as="script"><link rel="prefetch" href="/assets/index.html-ttOYcLxs.js" as="script"><link rel="prefetch" href="/assets/resume.html-Bg4V_YcH.js" as="script"><link rel="prefetch" href="/assets/404.html-CLkhUkcv.js" as="script"><link rel="prefetch" href="/assets/index.html-LqnJiIQb.js" as="script"><link rel="prefetch" href="/assets/index.html-Cahn3LsA.js" as="script"><link rel="prefetch" href="/assets/index.html-I_47fi89.js" as="script"><link rel="prefetch" href="/assets/index.html-CBwu0hid.js" as="script"><link rel="prefetch" href="/assets/index.html-BXyE5TQ5.js" as="script"><link rel="prefetch" href="/assets/index.html-CBz9L1hr.js" as="script"><link rel="prefetch" href="/assets/index.html-D6P8k8b2.js" as="script"><link rel="prefetch" href="/assets/index.html-B17Ejuyv.js" as="script"><link rel="prefetch" href="/assets/index.html-ClHDjS1j.js" as="script"><link rel="prefetch" href="/assets/index.html-DcyrT4up.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-BUCVUXiE.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script"><link rel="prefetch" href="/assets/giscus-BwIGYrs0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="Take me home"><img class="vp-nav-logo" src="/å°ç†ŠçŒ«.svg" alt><!----><!----></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="è¶…å¨è“çŒ«å°ç«™" iconsizing="height"><!---->è¶…å¨è“çŒ«å°ç«™<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/guosgbin/vuepress-blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis_Benchmark%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95.html" aria-label="Redis BenchmarkåŸºå‡†æµ‹è¯•" iconsizing="both"><!---->Redis BenchmarkåŸºå‡†æµ‹è¯•<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis_Cluster%E9%9B%86%E7%BE%A4%E5%92%8C%E6%A7%BD%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4.html" aria-label="Redis Clusteré›†ç¾¤å’Œæ§½ç®¡ç†å‘½ä»¤" iconsizing="both"><!---->Redis Clusteré›†ç¾¤å’Œæ§½ç®¡ç†å‘½ä»¤<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis_Cluster%E9%9B%86%E7%BE%A4%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7%E5%92%8C%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA.html" aria-label="Redis Clusteré›†ç¾¤åŸºæœ¬ç‰¹æ€§å’Œé›†ç¾¤æ­å»º" iconsizing="both"><!---->Redis Clusteré›†ç¾¤åŸºæœ¬ç‰¹æ€§å’Œé›†ç¾¤æ­å»º<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis_Cluster%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7redis-cli.html" aria-label="Redis Clusteré›†ç¾¤ç®¡ç†å·¥å…·redis-cli" iconsizing="both"><!---->Redis Clusteré›†ç¾¤ç®¡ç†å·¥å…·redis-cli<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis_key%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html" aria-label="Redis keyè®¾è®¡è§„èŒƒ" iconsizing="both"><!---->Redis keyè®¾è®¡è§„èŒƒ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis_Pipeline%E4%BC%98%E5%8C%96RTT.html" aria-label="Redis Pipelineä¼˜åŒ–RTT" iconsizing="both"><!---->Redis Pipelineä¼˜åŒ–RTT<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis_Sentinel%E9%AB%98%E5%8F%AF%E7%94%A8.html" aria-label="Redis Sentinelé«˜å¯ç”¨" iconsizing="both"><!---->Redis Sentinelé«˜å¯ç”¨<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/redis-cli%20%E4%BD%BF%E7%94%A8.html" aria-label="redis-cliä½¿ç”¨" iconsizing="both"><!---->redis-cliä½¿ç”¨<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis%E4%BA%8B%E5%8A%A1.html" aria-label="Redisäº‹åŠ¡" iconsizing="both"><!---->Redisäº‹åŠ¡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5.html" aria-label="Rediså†…å­˜æ·˜æ±°ç­–ç•¥" iconsizing="both"><!---->Rediså†…å­˜æ·˜æ±°ç­–ç•¥<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.html" aria-label="Rediså‘å¸ƒè®¢é˜…" iconsizing="both"><!---->Rediså‘å¸ƒè®¢é˜…<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/Redis/Redis%E5%A4%8D%E5%88%B6.html" aria-label="Rediså¤åˆ¶" iconsizing="both"><!---->Rediså¤åˆ¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis%E5%A4%A7key%E5%92%8C%E7%83%ADkey%E9%97%AE%E9%A2%98.html" aria-label="Rediså¤§keyå’Œçƒ­keyé—®é¢˜" iconsizing="both"><!---->Rediså¤§keyå’Œçƒ­keyé—®é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97.html" aria-label="Redisæ…¢æŸ¥è¯¢æ—¥å¿—" iconsizing="both"><!---->Redisæ…¢æŸ¥è¯¢æ—¥å¿—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6.html" aria-label="RedisæŒä¹…åŒ–æœºåˆ¶" iconsizing="both"><!---->RedisæŒä¹…åŒ–æœºåˆ¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/Redis/Redis%E9%94%AE%E7%A9%BA%E9%97%B4%E9%80%9A%E7%9F%A5(keyspace%20notification).html" aria-label="Redisé”®ç©ºé—´é€šçŸ¥" iconsizing="both"><!---->Redisé”®ç©ºé—´é€šçŸ¥<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Rediså¤åˆ¶</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">è¶…å¨è“çŒ« Dylan Kwok</span></span><span property="author" content="è¶…å¨è“çŒ« Dylan Kwok"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">April 3, 2025</span><meta property="datePublished" content="2025-04-03T07:07:29.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 34 min</span><meta property="timeRequired" content="PT34M"></span><!----><!----></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><table><thead><tr><th>ç‰ˆæœ¬</th><th>å†…å®¹</th><th>æ—¶é—´</th></tr></thead><tbody><tr><td>V1</td><td>æ–°å»º</td><td>2023å¹´04æœˆ02æ—¥00:44:03</td></tr></tbody></table><p>æœ¬æ–‡å†…å®¹æ¥è‡ª</p><ol><li><a href="https://redis.io/docs/management/replication/" target="_blank" rel="noopener noreferrer">https://redis.io/docs/management/replication/</a></li><li>ã€ŠRedis ä½¿ç”¨æ‰‹å†Œã€‹ -- å¯ä»¥</li><li>ã€ŠRedis å¼€å‘å’Œè¿ç»´ã€‹-- å¾ˆæ£’</li><li>ã€ŠRedis æ·±åº¦å†é™©ã€‹ -- å»ºè®®ä¸çœ‹è¿™ä¸ª</li></ol><h2 id="redis-å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#redis-å¤åˆ¶"><span>Redis å¤åˆ¶</span></a></h2><p>Redis æä¾›äº†å¤åˆ¶åŠŸèƒ½ï¼Œ å®ç°äº†ç›¸åŒæ•°æ®çš„å¤šä¸ª Redis å‰¯æœ¬ï¼Œ å¤åˆ¶åŠŸèƒ½æ˜¯é«˜å¯ç”¨ Redis çš„åŸºç¡€ã€‚</p><p>å‚ä¸å¤åˆ¶çš„ Redis åˆ†ä¸ºä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼Œä»èŠ‚ç‚¹ï¼ˆslave æˆ–è€… replicaï¼‰ã€‚</p><p>å¯¹äº Redis æ¥è¯´</p><ul><li>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æœ¬èº«ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ï¼›</li><li>ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼›</li></ul><p>é»˜è®¤æƒ…å†µä¸‹å¤„äºå¤åˆ¶æ¨¡å¼çš„ä¸»èŠ‚ç‚¹å¯ä»¥è¯»å†™ï¼Œä»èŠ‚ç‚¹åªèƒ½è¯»ï¼ˆå¯é…ç½®ï¼‰ã€‚</p><p>Redis çš„å¤åˆ¶çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿ</p><ol><li>æ€§èƒ½æ–¹é¢ï¼šRedis çš„å¤åˆ¶åŠŸèƒ½å¯ä»¥ç»™ç³»ç»Ÿçš„è¯»æ€§èƒ½å¸¦æ¥çº¿æ€§çº§åˆ«çš„æå‡ã€‚ä¸€èˆ¬æ¥è¯´ç”¨æˆ·æ¯å¢åŠ ä¸€å€æ•°é‡çš„ä»èŠ‚ç‚¹ï¼Œæ•´ä¸ªç³»ç»Ÿçš„è¯»æ€§èƒ½å°±èƒ½æå‡ä¸€å€ï¼›</li><li>å®‰å…¨æ€§ï¼šå¢åŠ ä»èŠ‚ç‚¹çš„æ•°é‡ï¼Œå¯ä»¥è¿›è¡Œä¸»èŠ‚ç‚¹çš„æ•…éšœè½¬ç§»ï¼›</li><li>é«˜å¯ç”¨ï¼šä½¿ç”¨ Redis çš„å¤åˆ¶åŠŸèƒ½å’Œ Sentinel åŠŸèƒ½ï¼Œå¯ä»¥ä¸ºæ•´ä¸ª Redis æœåŠ¡æä¾›é«˜å¯ç”¨ç‰¹æ€§ï¼›</li></ol><h2 id="cap-ç†è®º" tabindex="-1"><a class="header-anchor" href="#cap-ç†è®º"><span>CAP ç†è®º</span></a></h2><ul><li>C : Consistent ï¼Œ ä¸€è‡´æ€§ï¼›</li><li>A : Availability ï¼Œ å¯ç”¨æ€§ï¼›</li><li>P : Partition tolerance ï¼Œåˆ†åŒºå®¹é”™æ€§ï¼›</li></ul><p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹å¾€å¾€éƒ½æ˜¯åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿›è¡Œç½‘ç»œéš”ç¦»å¼€çš„ ï¼Œ è¿™æ„å‘³ç€å¿…ç„¶ä¼šæœ‰ç½‘ç»œæ–­å¼€çš„é£é™© ï¼Œ è¿™ä¸ªç½‘ç»œæ–­å¼€çš„åœºæ™¯çš„ä¸“ä¸šè¯æ±‡å«ä½œ<strong>ç½‘ç»œåˆ†åŒº</strong>ã€‚</p><p>åœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œä¸¤ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¹‹é—´æ— æ³•è¿›è¡Œé€šä¿¡ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œçš„ä¿®æ”¹æ“ä½œå°†æ— æ³•åŒæ­¥åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ•°æ®çš„<strong>ä¸€è‡´æ€§</strong>å°†æ— æ³•æ»¡è¶³ ï¼Œ å› ä¸ºä¸¤ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ•°æ®ä¸å†ä¿æŒä¸€è‡´ã€‚é™¤éæˆ‘ä»¬ç‰ºç‰²<strong>å¯ç”¨æ€§</strong>ï¼Œä¹Ÿå°±æ˜¯æš‚åœåˆ†å¸ƒå¼èŠ‚ç‚¹æœåŠ¡ ï¼Œ åœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œä¸å†æä¾›ä¿®æ”¹æ•°æ®çš„åŠŸèƒ½ï¼Œç›´åˆ°ç½‘ç»œçŠ¶å†µå®Œå…¨æ¢å¤æ­£å¸¸å†ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯<strong>å½“ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ ï¼Œ ä¸€è‡´æ€§å’Œå¯ç”¨æ€§åªèƒ½ä¿è¯ä¸€ä¸ª</strong>ã€‚</p><h2 id="é…ç½®ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç›¸å…³"><span>é…ç½®ç›¸å…³</span></a></h2><h3 id="å»ºç«‹å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#å»ºç«‹å¤åˆ¶"><span>å»ºç«‹å¤åˆ¶</span></a></h3><p>5.0.0 ä¹‹å‰ Redis ä¸€ç›´ä½¿ç”¨ slaveof ä½œä¸ºå¤åˆ¶å‘½ä»¤ï¼Œä» 5.0.0 ç‰ˆæœ¬å¼€å§‹å‡ºç°äº†æ–°çš„å¤åˆ¶å‘½ä»¤ replicaofï¼Œå¹¶é€æ¸åºŸå¼ƒåŸæ¥çš„ slaveof å‘½ä»¤ã€‚</p><p>æœ‰ä¸‰ç§æ–¹å¼å»ºç«‹å¤åˆ¶</p><ul><li>ç›´æ¥ä½¿ç”¨ slaveof æˆ–è€… replicaof å‘½ä»¤ï¼Œè®©å½“å‰èŠ‚ç‚¹ä½œä¸ºæŸä¸ªèŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li><li>åœ¨é…ç½®æ–‡ä»¶åœ¨æŒ‡å®šä¸»èŠ‚ç‚¹çš„ ip å’Œç«¯å£ï¼›</li><li>åœ¨ redis-server å¯åŠ¨å‘½ä»¤ååŠ å…¥å¯åŠ¨å‚æ•°æŒ‡å®šä¸»èŠ‚ç‚¹çš„ ip å’Œç«¯å£ï¼›</li></ul><p>ç›®å‰æˆ‘åœ¨æœ¬åœ°å¼€äº†ä¸¤ä¸ª Redis è¿›ç¨‹ï¼Œç«¯å£åˆ†åˆ«æ˜¯ 6379 å’Œ 10086ï¼Œå°† 10086 ç«¯å£çš„ Redis ä½œä¸º 6379 çš„ä»èŠ‚ç‚¹ã€‚</p><h4 id="åŠ¨æ€æŒ‡å®š" tabindex="-1"><a class="header-anchor" href="#åŠ¨æ€æŒ‡å®š"><span>åŠ¨æ€æŒ‡å®š</span></a></h4><p>ç›´æ¥ä½¿ç”¨ slaveof æˆ–è€… replicaof å‘½ä»¤</p><blockquote><p><a href="https://redis.io/commands/slaveof/" target="_blank" rel="noopener noreferrer">https://redis.io/commands/slaveof/</a></p><p><a href="https://redis.io/commands/replicaof/" target="_blank" rel="noopener noreferrer">https://redis.io/commands/replicaof/</a></p></blockquote><p>åœ¨ 10086 Redis çš„å®¢æˆ·ç«¯è¾“å…¥å‘½ä»¤</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:10086&gt; replicaof 127.0.0.1 6379</span></span>
<span class="line"><span>OK</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»èŠ‚ç‚¹æ—¥å¿—</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>67690:M 01 Apr 2023 23:57:31.566 * Replica 127.0.0.1:10086 asks for synchronization</span></span>
<span class="line"><span>67690:M 01 Apr 2023 23:57:31.566 * Partial resynchronization not accepted: Replication ID mismatch (Replica asked for &#39;14bd5efcae1e1bd1ed075eb2751db292a9a32cb0&#39;, my replication IDs are &#39;2e11109e0e9d006c4204cfac232598c83c125a77&#39; and &#39;0000000000000000000000000000000000000000&#39;)</span></span>
<span class="line"><span>67690:M 01 Apr 2023 23:57:31.566 * Replication backlog created, my new replication IDs are &#39;9fb57f9dd2175483564aef99f825bcf4a4d549a7&#39; and &#39;0000000000000000000000000000000000000000&#39;</span></span>
<span class="line"><span>67690:M 01 Apr 2023 23:57:31.567 * Starting BGSAVE for SYNC with target: disk</span></span>
<span class="line"><span>67690:M 01 Apr 2023 23:57:31.572 * Background saving started by pid 68439</span></span>
<span class="line"><span>68439:C 01 Apr 2023 23:57:31.573 * DB saved on disk</span></span>
<span class="line"><span>67690:M 01 Apr 2023 23:57:31.581 * Background saving terminated with success</span></span>
<span class="line"><span>67690:M 01 Apr 2023 23:57:31.581 * Synchronization with replica 127.0.0.1:10086 succeeded</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»èŠ‚ç‚¹æ—¥å¿—</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>67813:S 01 Apr 2023 23:57:31.561 * Before turning into a replica, using my own master parameters to synthesize a cached master: I may be able to synchronize with the new master with just a partial transfer.</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.562 * Connecting to MASTER 127.0.0.1:6379</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.562 * MASTER &lt;-&gt; REPLICA sync started</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.562 * REPLICAOF 127.0.0.1:6379 enabled (user request from &#39;id=3 addr=127.0.0.1:63385 laddr=127.0.0.1:10086 fd=8 name= age=339 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=44 qbuf-free=65486 argv-mem=22 obl=0 oll=0 omem=0 tot-mem=82998 events=r cmd=replicaof user=default redir=-1&#39;)</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.563 * Non blocking connect for SYNC fired the event.</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.565 * Master replied to PING, replication can continue...</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.565 * Trying a partial resynchronization (request 14bd5efcae1e1bd1ed075eb2751db292a9a32cb0:1).</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.572 * Full resync from master: 9fb57f9dd2175483564aef99f825bcf4a4d549a7:0</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.572 * Discarding previously cached master state.</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.581 * MASTER &lt;-&gt; REPLICA sync: receiving 176 bytes from master to disk</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.581 * MASTER &lt;-&gt; REPLICA sync: Flushing old data</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.581 * MASTER &lt;-&gt; REPLICA sync: Loading DB in memory</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.582 * Loading RDB produced by version 6.2.11</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.582 * RDB age 0 seconds</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.582 * RDB memory usage when created 2.08 Mb</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.582 # Done loading RDB, keys loaded: 0, keys expired: 0.</span></span>
<span class="line"><span>67813:S 01 Apr 2023 23:57:31.582 * MASTER &lt;-&gt; REPLICA sync: Finished with success</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>è¿™é‡Œä¸»è¦è¯´ä¸‹ä¸Šé¢æ—¥å¿—ä¸­çš„ Cã€Mã€S è¡¨ç¤ºä»€ä¹ˆ</p><ol><li>C è¡¨ç¤ºæ˜¯å­è¿›ç¨‹æ‰“å‡ºæ¥çš„æ—¥å¿—ï¼›</li><li>M è¡¨ç¤ºæ˜¯ Master èŠ‚ç‚¹çš„æ—¥å¿—ï¼›</li><li>S è¡¨ç¤ºæ˜¯ Slave èŠ‚ç‚¹çš„æ—¥å¿—ï¼›</li></ol></blockquote><p>è¿™æ ·ä¸»ä»èŠ‚ç‚¹å°±é…ç½®å¥½äº†ã€‚</p><p>slaveof å’Œ replicaof éƒ½æ˜¯å¼‚æ­¥å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œ å½“å‰èŠ‚ç‚¹åªä¿å­˜ä¸»èŠ‚ç‚¹ä¿¡æ¯åè¿”å›ï¼Œ åç»­å¤åˆ¶æµç¨‹åœ¨èŠ‚ç‚¹å†…éƒ¨å¼‚æ­¥æ‰§è¡Œã€‚</p><p>é€šè¿‡ info replication å‘½ä»¤æŸ¥çœ‹ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€</p><p>ä¸»èŠ‚ç‚¹ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:6379&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">role:master							</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å½“å‰èŠ‚ç‚¹çš„è§’è‰²</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">connected_slaves:1					</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¿æ¥çš„ä»èŠ‚ç‚¹ä¸ªæ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave0:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10086,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">online,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">offset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">266,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">lag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># idã€IPåœ°å€ã€ç«¯å£ã€çŠ¶æ€ã€åç§»é‡ã€æ»å</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_failover_state:no-failover	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ­£åœ¨è¿›è¡Œçš„æ•…éšœè½¬ç§»çš„çŠ¶æ€ï¼ˆå¦‚æœæœ‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid:02d649b60886a53ba1b19483707045bd0c2e8fd7	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å½“å‰èŠ‚ç‚¹çš„å¤åˆ¶ID </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid2:0000000000000000000000000000000000000000	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¾…åŠ©å¤åˆ¶IDï¼Œç”¨äºæ•…éšœè½¬ç§»åçš„ PSYNC å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_repl_offset:266				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># èŠ‚ç‚¹å½“å‰å¤åˆ¶åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_active:1				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ ‡è¯†å¤åˆ¶ç§¯å‹çš„æ ‡å¿—å¤„äºæ´»åŠ¨çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_size:1048576			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„æ€»å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_first_byte_offset:1 	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„ä¸»åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_histlen:266			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­æ•°æ®çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»èŠ‚ç‚¹ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:10086&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">role:slave							</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å½“å‰èŠ‚ç‚¹çš„è§’è‰²</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_host:127.0.0.1				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¸»èŠ‚ç‚¹çš„ ip</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_port:6379					</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¸»èŠ‚ç‚¹çš„ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_link_status:up				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¿æ¥çŠ¶æ€ up/down</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_last_io_seconds_ago:3		</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¸Šæ¬¡ä¸ master äº¤äº’çš„é—´éš”ç§’æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_sync_in_progress:0			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¡¨ç¤ºä¸»èŠ‚ç‚¹æ­£åœ¨åŒæ­¥åˆ°å‰¯æœ¬</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave_read_repl_offset:280			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»èŠ‚ç‚¹çš„è¯»å¤åˆ¶åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave_repl_offset:280				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave_priority:100					</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»èŠ‚ç‚¹ä½œä¸ºæ•…éšœè½¬ç§»å€™é€‰è€…çš„ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave_read_only:1					</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»èŠ‚ç‚¹æ˜¯å¦ä¸ºåªè¯»çš„æ ‡å¿—</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">replica_announced:1					</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»èŠ‚ç‚¹æ˜¯å¦ç”± Sentinel å®£å¸ƒçš„æ ‡å¿—</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">connected_slaves:0					</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¿æ¥çš„ä»èŠ‚ç‚¹ä¸ªæ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_failover_state:no-failover	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ­£åœ¨è¿›è¡Œçš„æ•…éšœè½¬ç§»çš„çŠ¶æ€ï¼ˆå¦‚æœæœ‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid:02d649b60886a53ba1b19483707045bd0c2e8fd7	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å½“å‰èŠ‚ç‚¹çš„å¤åˆ¶ID </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid2:0000000000000000000000000000000000000000 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¾…åŠ©å¤åˆ¶IDï¼Œç”¨äºæ•…éšœè½¬ç§»åçš„ PSYNC å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_repl_offset:280				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># èŠ‚ç‚¹å½“å‰å¤åˆ¶åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_active:1				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ ‡è¯†å¤åˆ¶ç§¯å‹çš„æ ‡å¿—å¤„äºæ´»åŠ¨çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_size:1048576			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„æ€»å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_first_byte_offset:1 	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„ä¸»åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_histlen:280			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­æ•°æ®çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é…ç½®æ–‡ä»¶æŒ‡å®š" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ–‡ä»¶æŒ‡å®š"><span>é…ç½®æ–‡ä»¶æŒ‡å®š</span></a></h4><p>åœ¨é…ç½®æ–‡ä»¶åŠ ä¸Šè¿™ä¸ªé…ç½®é¡¹</p><ul><li>Redis 5 ä¹‹å‰æ˜¯ <code> slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li><li>Reids 5 ä¹‹åæ˜¯ <code>replicaof &lt;masterip&gt; &lt;masterport&gt;</code></li></ul><p>è¿™é‡Œæˆ‘æŒ‡å®š 6379 ç«¯å£ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">replicaof 127.0.0.1 6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="redis-server-å¯åŠ¨å‘½ä»¤æŒ‡å®š" tabindex="-1"><a class="header-anchor" href="#redis-server-å¯åŠ¨å‘½ä»¤æŒ‡å®š"><span>redis-server å¯åŠ¨å‘½ä»¤æŒ‡å®š</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>./redis-server  --replicaof 127.0.0.1 6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="å–æ¶ˆå¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#å–æ¶ˆå¤åˆ¶"><span>å–æ¶ˆå¤åˆ¶</span></a></h3><p>åœ¨å°†ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸ºä»èŠ‚ç‚¹ä¹‹åï¼Œå¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œè®©ä»èŠ‚ç‚¹åœæ­¢å¤åˆ¶ï¼Œé‡æ–°å˜æˆä¸»èŠ‚ç‚¹ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>replicaof no one</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>salveof no one</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>èŠ‚ç‚¹åœ¨åœæ­¢å¤åˆ¶ä¹‹åä¸ä¼šæ¸…ç©ºæ•°æ®åº“ï¼Œè€Œæ˜¯ç»§ç»­ä¿ç•™å¤åˆ¶äº§ç”Ÿçš„æ‰€æœ‰æ•°æ®ã€‚</strong></p><p>æ“ä½œä¸€ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:10086&gt; slaveof no one</span></span>
<span class="line"><span>OK</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»èŠ‚ç‚¹æ—¥å¿—</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>69576:M 02 Apr 2023 00:39:59.503 # Connection with replica 127.0.0.1:10086 lost.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»èŠ‚ç‚¹æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„æ—¥å¿—çš„ä»å‰é¢çš„ S å˜æˆäº† Mã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>69865:M 02 Apr 2023 00:39:59.502 # Connection with master lost.</span></span>
<span class="line"><span>69865:M 02 Apr 2023 00:39:59.502 * Caching the disconnected master state.</span></span>
<span class="line"><span>69865:M 02 Apr 2023 00:39:59.502 * Discarding previously cached master state.</span></span>
<span class="line"><span>69865:M 02 Apr 2023 00:39:59.503 # Setting secondary replication ID to 02d649b60886a53ba1b19483707045bd0c2e8fd7, valid up to offset: 2087. New replication ID is bf5cb4acb80123f1422fb780043a9b79f20017ae</span></span>
<span class="line"><span>69865:M 02 Apr 2023 00:39:59.503 * MASTER MODE enabled (user request from &#39;id=5 addr=127.0.0.1:63961 laddr=127.0.0.1:10086 fd=9 name= age=1476 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=34 qbuf-free=65496 argv-mem=12 obl=0 oll=0 omem=0 tot-mem=82988 events=r cmd=slaveof user=default redir=-1&#39;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡å–æ¶ˆå¤åˆ¶çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°åˆ‡ä¸»çš„æ“ä½œï¼Œé‡æ–°å’Œä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹å¤åˆ¶å…³ç³»ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜å¥½æ•°æ®ï¼Œå› ä¸ºåˆ‡ä¸»æ“ä½œä¼šæ¸…ç©ºå½“å‰èŠ‚ç‚¹å†…å­˜ä¸­çš„æ•°æ®ã€‚</p><h3 id="ä¸»ä»å¤åˆ¶å¯†ç æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶å¯†ç æ ¡éªŒ"><span>ä¸»ä»å¤åˆ¶å¯†ç æ ¡éªŒ</span></a></h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¸»èŠ‚ç‚¹éƒ½ä¼šé€šè¿‡ä¸‹é¢çš„é…ç½®é¡¹è®¾ç½®ç™»å½•å¯†ç </p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>requirepass å¯†ç </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ—¶å‡å¦‚æŸä¸ªèŠ‚ç‚¹éœ€è¦å’Œä¸»èŠ‚ç‚¹å»ºç«‹å¤åˆ¶è¿æ¥ï¼Œä½œä¸ºä»èŠ‚ç‚¹éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸»èŠ‚ç‚¹çš„å¯†ç æ‰èƒ½å»ºç«‹è¿æ¥</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>masterauth ä¸»èŠ‚ç‚¹å¯†ç </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="ä»èŠ‚ç‚¹è®¾ç½®åªè¯»" tabindex="-1"><a class="header-anchor" href="#ä»èŠ‚ç‚¹è®¾ç½®åªè¯»"><span>ä»èŠ‚ç‚¹è®¾ç½®åªè¯»</span></a></h3><p>redis 5 ä»¥ä¸Šçš„é…ç½®</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>replica-read-only yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>redis 5 ä¸€ä¸‹çš„é…ç½®</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>slave-read-only yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ—¶å‡å¦‚æƒ³åœ¨ä»èŠ‚ç‚¹å†™æ“ä½œå°±ä¼šæŠ¥é”™</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>(error) READONLY You can&#39;t write against a read only replica.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="å¤åˆ¶æ¶æ„" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶æ¶æ„"><span>å¤åˆ¶æ¶æ„</span></a></h2><p>å¯¹äº Redis æ¥è¯´ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰ä»»æ„å¤šä¸ªä»èŠ‚ç‚¹ï¼Œè€Œä»èŠ‚ç‚¹æœ¬èº«ä¹Ÿå¯ä»¥ç”¨ä½œå…¶ä»–èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´æ”¯æŒå•å±‚å’Œå¤šå±‚å¤åˆ¶å…³ç³»ã€‚</p><p>å¯ä»¥åˆ†ä¸ºä¸‹é¢å‡ ç§ä¸€ä¸»ä¸€ä»ã€ä¸€ä¸»å¤šä»ã€æ ‘çŠ¶ä¸»ä»ç»“æ„ã€‚</p><h3 id="ä¸€ä¸»ä¸€ä»" tabindex="-1"><a class="header-anchor" href="#ä¸€ä¸»ä¸€ä»"><span>ä¸€ä¸»ä¸€ä»</span></a></h3><p>ä¸€ä¸»ä¸€ä»éƒ¨ç½²æ¶æ„ä¸»è¦ä½œç”¨äºæ•…éšœè½¬ç§»ã€‚</p><p>å½“åº”ç”¨çš„å†™æ“ä½œçš„å¹¶å‘é‡æ¯”è¾ƒé«˜ä¸”éœ€è¦æŒä¹…åŒ–æ—¶ï¼Œå¯ä»¥åªåœ¨ä»èŠ‚ç‚¹ä¸Šé¢å¼€å¯ AOFï¼Œè¿™æ ·æ—¢å¯ä»¥ä¿è¯æ•°æ®å®‰å…¨ï¼Œä¹Ÿæé«˜äº†ä¸»èŠ‚ç‚¹çš„æ€§èƒ½ã€‚</p><h3 id="ä¸€ä¸»å¤šä»-æ˜Ÿå‹å¤åˆ¶æ¶æ„" tabindex="-1"><a class="header-anchor" href="#ä¸€ä¸»å¤šä»-æ˜Ÿå‹å¤åˆ¶æ¶æ„"><span>ä¸€ä¸»å¤šä»ï¼ˆæ˜Ÿå‹å¤åˆ¶æ¶æ„ï¼‰</span></a></h3><p>æ˜Ÿå‹å¤åˆ¶æ¶æ„å¯ä»¥ä½¿å¾—åº”ç”¨ç«¯åˆ©ç”¨å¤šä¸ªä»èŠ‚ç‚¹å®ç°è¯»å†™åˆ†ç¦»ã€‚</p><ul><li>æ‰€æœ‰åªè¯»èŠ‚ç‚¹å‡å…·å¤‡å®¹ç¾åŠŸèƒ½ï¼Œå¯ä½œä¸ºå¤‡èŠ‚ç‚¹è¿›è¡Œæ•°æ®å¤‡ä»½ã€‚</li><li>åªè¯»èŠ‚ç‚¹å‡ä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œä¸ºæ˜Ÿå‹å¤åˆ¶æ¶æ„ï¼Œæ•°æ®åŒæ­¥å»¶è¿Ÿè¿œå°äºé“¾å¼å¤åˆ¶æ¶æ„ã€‚</li></ul><img src="/assets/image-20230402155532164-BabWvULm.png" alt="image-20230402155532164" style="zoom:50%;"><h3 id="æ ‘çŠ¶ç»“æ„-é“¾å¼å¤åˆ¶æ¶æ„" tabindex="-1"><a class="header-anchor" href="#æ ‘çŠ¶ç»“æ„-é“¾å¼å¤åˆ¶æ¶æ„"><span>æ ‘çŠ¶ç»“æ„ï¼ˆé“¾å¼å¤åˆ¶æ¶æ„ï¼‰</span></a></h3><p>æ ‘çŠ¶ä¸»ä»ç»“æ„ï¼Œä»èŠ‚ç‚¹ä¸ä»…å¯ä»¥å¤åˆ¶ä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼ŒåŒæ—¶ä»èŠ‚ç‚¹ä¹Ÿèƒ½ä½œä¸ºå…¶ä»–ä»èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥å‡å°‘ä¸»èŠ‚ç‚¹çš„è´Ÿè½½å’Œéœ€è¦ä¼ é€ç»™ä»èŠ‚ç‚¹çš„æ•°æ®é‡ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯åªè¯»èŠ‚ç‚¹é‡‡å–é“¾å¼å¤åˆ¶æ¶æ„ï¼Œå½“åªè¯»èŠ‚ç‚¹æ•°è¶Šå¤šï¼Œ<strong>é è¿‘é“¾è·¯æœ«ç«¯çš„åªè¯»èŠ‚ç‚¹æ•°æ®å»¶è¿Ÿè¶Šå¤§</strong>ã€‚</p><img src="/assets/image-20230402155548435-r3zzPPYl.png" alt="image-20230402155548435" style="zoom:50%;"><h2 id="æŸ¥çœ‹èŠ‚ç‚¹è§’è‰²-role" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹èŠ‚ç‚¹è§’è‰²-role"><span>æŸ¥çœ‹èŠ‚ç‚¹è§’è‰² ROLE</span></a></h2><blockquote><p><a href="https://redis.io/commands/role/" target="_blank" rel="noopener noreferrer">https://redis.io/commands/role/</a></p></blockquote><h3 id="ä¸»èŠ‚ç‚¹çš„è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#ä¸»èŠ‚ç‚¹çš„è¾“å‡º"><span>ä¸»èŠ‚ç‚¹çš„è¾“å‡º</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1) &quot;master&quot;</span></span>
<span class="line"><span>2) (integer) 3129659</span></span>
<span class="line"><span>3) 1) 1) &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>      2) &quot;10086&quot;</span></span>
<span class="line"><span>      3) &quot;3129242&quot;</span></span>
<span class="line"><span>   2) 1) &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>      2) &quot;10000&quot;</span></span>
<span class="line"><span>      3) &quot;3129543&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆç»“æœ</p><ul><li>ç¬¬ä¸€ä¸ªå…ƒç´  master è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹ï¼›</li><li>ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼ˆreplication offsetï¼‰ï¼Œè®°å½•äº†ä¸»èŠ‚ç‚¹ç›®å‰å‘å¤åˆ¶æ•°æ®æµå‘é€çš„æ•°æ®æ•°é‡ï¼›</li><li>ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ä¸ªæ•°ç»„ï¼šè®°å½•äº†ä¸»èŠ‚ç‚¹ä¸‹é¢çš„æ‰€æœ‰ä»èŠ‚ç‚¹ <ul><li>ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šä»èŠ‚ç‚¹ IP åœ°å€ï¼›</li><li>ç¬¬äºŒä¸ªå…ƒç´ ï¼šä»èŠ‚ç‚¹ç«¯å£å·ï¼›</li><li>ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼šä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ã€‚ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡è®°å½•äº†ä»èŠ‚ç‚¹é€šè¿‡å¤åˆ¶æ•°æ®æµæ¥æ”¶åˆ°çš„æ•°æ®æ•°é‡ï¼Œä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ä¸ä¸»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ä¿æŒä¸€è‡´æ—¶ï¼Œå®ƒä»¬çš„æ•°æ®å°±æ˜¯ä¸€è‡´çš„ï¼›</li></ul></li></ul><h3 id="ä»èŠ‚ç‚¹çš„è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#ä»èŠ‚ç‚¹çš„è¾“å‡º"><span>ä»èŠ‚ç‚¹çš„è¾“å‡º</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1) &quot;slave&quot;</span></span>
<span class="line"><span>2) &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>3) (integer) 10086</span></span>
<span class="line"><span>4) &quot;connected&quot;</span></span>
<span class="line"><span>5) (integer) 3167038</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¬¬ä¸€ä¸ªå…ƒç´  slave è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯ä»èŠ‚ç‚¹ï¼›</li><li>ç¬¬äºŒä¸ªå…ƒç´ ï¼šä»èŠ‚ç‚¹ IP åœ°å€ï¼›</li><li>ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼šä»èŠ‚ç‚¹ç«¯å£å·ï¼›</li><li>ç¬¬å››ä¸ªå…ƒç´ ï¼šä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„å½“å‰è¿æ¥çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼æœ‰ä¸‹é¢ <ul><li>noneï¼šä¸»ä»èŠ‚ç‚¹å°šæœªå»ºç«‹è¿æ¥ï¼›</li><li>connectï¼šä¸»ä»èŠ‚ç‚¹æ­£åœ¨æ¡æ‰‹ï¼›</li><li>connectingï¼šä¸»ä»èŠ‚ç‚¹æˆåŠŸå»ºç«‹äº†è¿æ¥ï¼›</li><li>syncï¼šä¸»ä»èŠ‚ç‚¹æ­£åœ¨è¿›è¡Œæ•°æ®åŒæ­¥ï¼›</li><li>connectedï¼šä¸»ä»èŠ‚ç‚¹å·²è¿›å…¥åœ¨çº¿æ›´æ–°çŠ¶æ€ï¼›</li><li>unkownï¼šä¸»ä»èŠ‚ç‚¹è¿æ¥çŠ¶æ€æœªçŸ¥ï¼›</li></ul></li><li>ç¬¬äº”ä¸ªå…ƒç´ ï¼šä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ã€‚ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡è®°å½•äº†ä»èŠ‚ç‚¹é€šè¿‡å¤åˆ¶æ•°æ®æµæ¥æ”¶åˆ°çš„æ•°æ®æ•°é‡ï¼Œä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ä¸ä¸»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ä¿æŒä¸€è‡´æ—¶ï¼Œå®ƒä»¬çš„æ•°æ®å°±æ˜¯ä¸€è‡´çš„ï¼›</li></ul><h3 id="å“¨å…µèŠ‚ç‚¹è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#å“¨å…µèŠ‚ç‚¹è¾“å‡º"><span>å“¨å…µèŠ‚ç‚¹è¾“å‡º</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1) &quot;sentinel&quot;</span></span>
<span class="line"><span>2) 1) &quot;resque-master&quot;</span></span>
<span class="line"><span>   2) &quot;html-fragments-master&quot;</span></span>
<span class="line"><span>   3) &quot;stats-master&quot;</span></span>
<span class="line"><span>   4) &quot;metadata-master&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å­—ç¬¦ä¸² sentinelã€‚</li><li>æ­¤ Sentinel å®ä¾‹ç›‘æ§çš„ä¸»èŠ‚ç‚¹åç§°çš„æ•°ç»„ã€‚</li></ul><h2 id="å¤åˆ¶-id-è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶-id-è¯´æ˜"><span>å¤åˆ¶ ID è¯´æ˜</span></a></h2><p>å®ä¾‹å®é™…ä¸Šæœ‰ä¸¤ä¸ªå¤åˆ¶ IDï¼šä¸» IDå’Œè¾…åŠ©çš„ IDã€‚</p><p>å¤åˆ¶ ID åŸºæœ¬ä¸Šæ ‡è®°äº†æ•°æ®é›†çš„ç»™å®šå†å²è®°å½•ã€‚æ¯æ¬¡ä¸€ä¸ªå®ä¾‹ä»å¤´å¼€å§‹ä½œä¸ºä¸»èŠ‚ç‚¹é‡æ–°å¯åŠ¨ï¼Œæˆ–è€…ä¸€ä¸ªå‰¯æœ¬è¢«æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¸ºè¯¥å®ä¾‹ç”Ÿæˆä¸€ä¸ªæ–°çš„å¤åˆ¶ IDã€‚è¿æ¥åˆ°ä¸»èŠ‚ç‚¹çš„å‰¯æœ¬å°†åœ¨æ¡æ‰‹åç»§æ‰¿å…¶å¤åˆ¶ IDã€‚å› æ­¤ï¼Œå…·æœ‰ç›¸åŒ å¤åˆ¶ ID çš„ä¸¤ä¸ªå®ä¾‹ä¹‹é—´çš„å…³ç³»åœ¨äºå®ƒä»¬æŒæœ‰ç›¸åŒçš„æ•°æ®ï¼Œä½†å¯èƒ½åœ¨ä¸åŒçš„æ—¶é—´ã€‚åç§»é‡ä½œä¸ºé€»è¾‘æ—¶é—´æ¥ç†è§£ï¼Œåœ¨ç»™å®šçš„å†å²è®°å½•ï¼ˆå¤åˆ¶IDï¼‰ä¸­ï¼Œè°æŒæœ‰æœ€æ–°çš„æ•°æ®é›†ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªå®ä¾‹Aå’ŒBå…·æœ‰ç›¸åŒçš„å¤åˆ¶IDï¼Œä½†ä¸€ä¸ªåç§»é‡ä¸º1000ï¼Œå¦ä¸€ä¸ªåç§»é‡ä¸º1023ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªå®ä¾‹ç¼ºå°‘åº”ç”¨äºæ•°æ®é›†çš„æŸäº›å‘½ä»¤ã€‚è¿™ä¹Ÿæ„å‘³ç€Aåªéœ€åº”ç”¨å°‘é‡å‘½ä»¤ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¸Bå®Œå…¨ç›¸åŒçš„çŠ¶æ€ã€‚</p><p>Redis ä¸»èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå¤åˆ¶ IDï¼Œä¸€ä¸ªæ˜¯ä¸» IDï¼Œå¦ä¸€ä¸ªæ˜¯è¾…åŠ© IDã€‚ä¸» ID æ˜¯ Redis ä¸»èŠ‚ç‚¹çš„å½“å‰å¤åˆ¶ IDï¼Œç”¨äºæ ‡è¯† Redis ä¸»èŠ‚ç‚¹å½“å‰çš„å¤åˆ¶å†å²è®°å½•ã€‚è€Œè¾…åŠ© ID åˆ™æ˜¯ç”¨äºåœ¨ Redis ä¸»èŠ‚ç‚¹è¿›è¡Œæ•…éšœè½¬ç§»åï¼Œè¾…åŠ© Redis å‰¯æœ¬æ­£ç¡®åŒæ­¥æ•°æ®æ‰€éœ€çš„å¤åˆ¶ IDã€‚å½“ Redis ä¸»èŠ‚ç‚¹è¿›è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œæ–°çš„ä¸»èŠ‚ç‚¹ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å¤åˆ¶ ID æ¥æ ‡è¯†æ–°çš„å¤åˆ¶å†å²è®°å½•ï¼ŒåŒæ—¶å°†æ—§çš„å¤åˆ¶ ID ä½œä¸ºè¾…åŠ© ID å­˜å‚¨åœ¨ä¸»èŠ‚ç‚¹ä¸­ã€‚è¿™æ ·ï¼Œå…¶ä»–å‰¯æœ¬å°±å¯ä»¥ä½¿ç”¨è¾…åŠ© ID æ¥æ­£ç¡®åœ°è¿›è¡ŒåŒæ­¥ï¼Œè€Œä¸ä¼šä¸æ—§çš„å†å²è®°å½•æ··æ·†ã€‚åŒæ—¶ï¼Œä¸» ID ä¹Ÿä¼šæ›´æ–°ä¸ºæ–°çš„å¤åˆ¶ ID ä»¥ç¡®ä¿æ‰€æœ‰å®ä¾‹éƒ½ä½¿ç”¨æ­£ç¡®çš„å¤åˆ¶ IDã€‚å› æ­¤ï¼ŒRedis ä¸»èŠ‚ç‚¹çš„ info replication å‘½ä»¤ä¼šæ˜¾ç¤ºä¸¤ä¸ªå¤åˆ¶ IDï¼Œä»¥ä¾¿ç®¡ç†å‘˜å¯ä»¥äº†è§£ä¸»èŠ‚ç‚¹å½“å‰çš„å¤åˆ¶å†å²è®°å½•ï¼Œå¹¶åœ¨æ•…éšœè½¬ç§»åç¡®è®¤å‰¯æœ¬æ˜¯å¦æ­£ç¡®åŒæ­¥ã€‚</p><p>å¦‚æœæ‚¨æƒ³çŸ¥é“ä¸ºä»€ä¹ˆåœ¨æ•…éšœè½¬ç§»åæå‡ä¸ºä¸»èŠ‚ç‚¹çš„å‰¯æœ¬éœ€è¦æ›´æ”¹å…¶å¤åˆ¶IDï¼šå¯èƒ½æ˜¯ç”±äºæŸäº›ç½‘ç»œåˆ†åŒºçš„åŸå› ï¼Œæ—§ä¸»èŠ‚ç‚¹ä»ç„¶ä½œä¸ºä¸»èŠ‚ç‚¹è¿è¡Œï¼šä¿ç•™ç›¸åŒçš„å¤åˆ¶IDå°†è¿åä»»æ„ä¸¤ä¸ªéšæœºå®ä¾‹å…·æœ‰ç›¸åŒæ•°æ®é›†çš„ç›¸åŒIDå’Œç›¸åŒåç§»é‡çš„äº‹å®ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:6379&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">role:master</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">connected_slaves:2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave0:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10086,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">online,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">offset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">28207,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">lag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave1:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">online,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">offset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">lag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">18852</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid:8909d9d2679658bbd539da23ca2f242428fcb25d</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid2:0000000000000000000000000000000000000000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_repl_offset:28207</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_first_byte_offset:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_histlen:28207</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ•°æ®åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åŒæ­¥"><span>æ•°æ®åŒæ­¥</span></a></h2><h3 id="å¤åˆ¶è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶è¿‡ç¨‹"><span>å¤åˆ¶è¿‡ç¨‹</span></a></h3><ul><li><p><strong>ä¿å­˜ä¸»èŠ‚ç‚¹ä¿¡æ¯</strong>ï¼›</p></li><li><p><strong>ä¸»ä»å»ºç«‹ socket è¿æ¥</strong>ï¼š</p><p>ä»èŠ‚ç‚¹å†…éƒ¨é€šè¿‡æ¯ç§’è¿è¡Œçš„å®šæ—¶ä»»åŠ¡ç»´æŠ¤å¤åˆ¶ç›¸å…³é€»è¾‘ï¼Œå½“å®šæ—¶ä»»åŠ¡å‘ç°å­˜åœ¨æ–°çš„ä¸»èŠ‚ç‚¹åï¼Œä¼šå°è¯•ä¸è¯¥èŠ‚ç‚¹å»ºç«‹ç½‘ç»œè¿æ¥ã€‚è¿æ¥æˆåŠŸåä»èŠ‚ç‚¹æ‰“å°ä¸‹é¢çš„æ—¥å¿—</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>75102:S 02 Apr 2023 15:36:43.820 * Connecting to MASTER 127.0.0.1:6379</span></span>
<span class="line"><span>75102:S 02 Apr 2023 15:36:43.820 * MASTER &lt;-&gt; REPLICA sync started</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä»èŠ‚ç‚¹æ— æ³•å»ºç«‹è¿æ¥ï¼Œå®šæ—¶ä»»åŠ¡ä¼šæ— é™é‡è¯•ç›´åˆ°è¿æ¥æˆåŠŸæˆ–è€…æ‰§è¡Œå–æ¶ˆè¿æ¥çš„å‘½ä»¤ã€‚</p></li><li><p><strong>å‘é€ ping å‘½ä»¤</strong></p><p>è¿æ¥å»ºç«‹æˆåŠŸåä»èŠ‚ç‚¹å‘é€ ping è¯·æ±‚è¿›è¡Œé¦–æ¬¡é€šä¿¡ï¼Œping çš„ç›®çš„æ˜¯æ£€æŸ¥ä¸»ä»ä¹‹é—´ç½‘ç»œå¥—æ¥å­—æ˜¯å¦å¯ç”¨ã€æ£€æµ‹ä¸»èŠ‚ç‚¹å½“å‰æ˜¯å¦å¯ä»¥æ¥æ”¶å¤„ç†å‘½ä»¤ã€‚å¦‚æœä»èŠ‚ç‚¹å‘é€ ping å‘½ä»¤åï¼Œä¸›åŠè¯¶å•æ²¡æœ‰æ¥æ”¶åˆ°ä¸»èŠ‚ç‚¹çš„ pong æˆ–è€…è¶…æ—¶ï¼Œä»èŠ‚ç‚¹ä¼šæ–­å¼€å¤åˆ¶è¿æ¥ï¼Œä¸‹æ¬¡å®šæ—¶ä»»åŠ¡ä¼šå‘èµ·é‡è¿ã€‚</p><p>ä»èŠ‚ç‚¹è·å¾—åˆ°ä¸»èŠ‚ç‚¹çš„ pong åä¼šæ‰“å°ä¸‹é¢çš„æ—¥å¿—</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>75102:S 02 Apr 2023 15:36:43.820 * Master replied to PING, replication can continue...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æƒé™éªŒè¯ã€‚</strong></p><p>å¦‚æœä¸»èŠ‚ç‚¹è®¾ç½®äº† requirepass å‚æ•°ï¼Œåˆ™éœ€è¦å¯†ç éªŒè¯ã€‚ä»èŠ‚ç‚¹éœ€è¦é…ç½® masterauthï¼›</p></li><li><p><strong>åŒæ­¥æ•°æ®</strong></p><p>ä¸»ä»å¤åˆ¶è¿æ¥æ­£å¸¸é€šä¿¡åï¼Œå¯¹äºé¦–æ¬¡å»ºç«‹å¤åˆ¶çš„åœºæ™¯ï¼Œä¸»èŠ‚ç‚¹ä¼šæŠŠå®ƒçš„æ•°æ®å…¨éƒ¨å‘é€ç»™ä»èŠ‚ç‚¹ã€‚</p></li><li><p><strong>å‘½ä»¤æŒç»­å¤åˆ¶</strong></p><p>å½“ä¸»èŠ‚ç‚¹æŠŠå½“å‰çš„æ•°æ®åŒæ­¥ç»™ä»èŠ‚ç‚¹åï¼Œä¾¿å®Œæˆäº†å¤åˆ¶çš„å»ºç«‹æµç¨‹ã€‚æ¥ä¸‹æ¥ä¸»èŠ‚ç‚¹ä¼šæŒç»­çš„æŠŠå†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿å­˜ä¸»ä»æ•°æ®ä¸€è‡´æ€§ã€‚</p></li></ul><h3 id="æ•°æ®åŒæ­¥-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åŒæ­¥-1"><span>æ•°æ®åŒæ­¥</span></a></h3><p>æ•°æ®åŒæ­¥åˆ†ä¸ºå®Œæ•´åŒæ­¥ã€åœ¨çº¿æ›´æ–°ã€éƒ¨åˆ†åŒæ­¥ã€‚</p><ul><li>å®Œæ•´åŒæ­¥ï¼šä¸€èˆ¬ç”¨äºå»ºç«‹è¿æ¥åˆæ¬¡å¤åˆ¶çš„åœºæ™¯ï¼›</li><li>éƒ¨åˆ†åŒæ­¥ï¼šRedis 2.8 ä»¥åæä¾›äº†éƒ¨åˆ†åŒæ­¥çš„åŠŸèƒ½ï¼›</li><li>åœ¨çº¿æ›´æ–°ï¼šå°±æ˜¯æ¯å½“ä¸»èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤åï¼Œä¸»èŠ‚ç‚¹ä¼šå°†ç›¸åŒçš„å†™å‘½ä»¤æˆ–è€…å…·æœ‰ç›¸åŒæ•ˆæœçš„å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼›</li></ul><h4 id="å®Œæ•´åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#å®Œæ•´åŒæ­¥"><span>å®Œæ•´åŒæ­¥</span></a></h4><p>å½“ä¸€ä¸ª Redis èŠ‚ç‚¹æ¥æ”¶åˆ° replicaofã€slaveof å‘½ä»¤ï¼Œå¼€å§‹å¯¹å¦ä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œå¤åˆ¶æ—¶ï¼š</p><ul><li>ä»èŠ‚ç‚¹å‘é€ psync å‘½ä»¤ï¼ˆæ—§ç‰ˆæœ¬æ˜¯ syncï¼‰ç»™ä¸»èŠ‚ç‚¹ï¼Œå‘é€ä»èŠ‚ç‚¹çš„æ—§ä¸»å¤åˆ¶ ID å’Œå®ƒä»¬åˆ°ç›®å‰ä¸ºæ­¢å¤„ç†çš„åç§»é‡ï¼Œä¸»èŠ‚ç‚¹æ ¹æ®è‡ªå·±çš„çŠ¶æ€å†³å®šæ˜¯å®Œæ•´åŒæ­¥è¿˜æ˜¯éƒ¨åˆ†åŒæ­¥ï¼›</li><li>ä¸»èŠ‚ç‚¹æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œç”Ÿæˆä¸€ä¸ª RDB æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ç¼“å†²åŒºå­˜å‚¨ bgsave å‘½ä»¤ä¹‹åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼›</li><li>å½“ RDB æ–‡ä»¶åˆ›å»ºå®Œæ¯•ï¼Œä¸»èŠ‚ç‚¹ä¼šé€šè¿‡å¥—æ¥å­—å°† RDB æ–‡ä»¶ä¼ é€ç»™ä»èŠ‚ç‚¹ï¼›</li><li>ä»èŠ‚ç‚¹åœ¨æ¥æ”¶å®Œä¸»èŠ‚ç‚¹ä¼ é€è¿‡æ¥çš„ RDB æ–‡ä»¶ä¹‹åï¼Œå…ˆæ¸…ç©ºè‡ªå·±çš„æ•°æ®åº“ï¼Œç„¶åè½½å…¥è¿™ä¸ª RDB æ–‡ä»¶ï¼Œä»è€Œè·å¾—ä¸»èŠ‚ç‚¹åœ¨æ‰§è¡Œ bgsave å‘½ä»¤æ—¶çš„æ‰€æœ‰æ•°æ®ï¼›</li><li>å½“ä»èŠ‚ç‚¹å®Œæˆ RDB æ–‡ä»¶çš„åŠ è½½åŠ¨ä½œåï¼Œå¹¶å¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šæŠŠä¹‹å‰å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹æ‰§è¡Œï¼›å¦‚æœä¸»èŠ‚ç‚¹åˆ›å»ºå’Œä¼ è¾“ RDB çš„æ—¶é—´è¿‡é•¿ï¼Œ å¯¹äºé«˜æµé‡å†™å…¥åœºæ™¯éå¸¸å®¹æ˜“é€ æˆä¸»èŠ‚ç‚¹å¤åˆ¶å®¢æˆ·ç«¯ç¼“å†²åŒºæº¢å‡ºã€‚ é»˜è®¤é…ç½®ä¸º clientoutput-buffer-limit slave 256MB 64MB 60ï¼Œ å¦‚æœ 60 ç§’å†…ç¼“å†²åŒºæ¶ˆè€—æŒç»­å¤§äº 64MB æˆ–è€…ç›´æ¥è¶…è¿‡ 256MB æ—¶ï¼Œ ä¸»èŠ‚ç‚¹å°†ç›´æ¥å…³é—­å¤åˆ¶å®¢æˆ·ç«¯è¿æ¥ï¼Œ é€ æˆå…¨é‡åŒæ­¥å¤±è´¥ã€‚ å¯¹åº”æ—¥å¿—å¦‚ä¸‹ï¼š</li></ul><img src="/assets/image-20230402175335595-5Ypm-zUI.png" alt="image-20230402175335595" style="zoom:50%;"><p>æ¯ä¸ªæœåŠ¡å™¨åœ¨åˆšå¼€å§‹è¿›è¡Œå¤åˆ¶çš„æ—¶å€™ï¼Œéƒ½éœ€è¦ä¸ä¸»æœåŠ¡å™¨è¿›è¡Œä¸€æ¬¡å®Œæ•´åŒæ­¥ã€‚å®Œæ•´åŒæ­¥çš„å‘½ä»¤æ˜¯ sync å’Œ psyncã€‚å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œä¼šå¯¹ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹é€ æˆå¾ˆå¤§çš„ç½‘ç»œå¼€é”€ã€‚</p><p>ä»èŠ‚ç‚¹æ—¥å¿—ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>83156:S 02 Apr 2023 17:33:07.077 * Connecting to MASTER 127.0.0.1:6379</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.077 * MASTER &lt;-&gt; REPLICA sync started</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.077 * Non blocking connect for SYNC fired the event.</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.077 * Master replied to PING, replication can continue...</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.077 * Trying a partial resynchronization (request 34d39a331978a925fc9d138919ce80f1f023fc66:99).</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.080 * Full resync from master: fc318b44d1f853caaed26b6e608e55d1a09ad2de:0</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.080 * Discarding previously cached master state.</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.149 * MASTER &lt;-&gt; REPLICA sync: receiving 193 bytes from master to disk</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.149 * MASTER &lt;-&gt; REPLICA sync: Flushing old data</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.149 * MASTER &lt;-&gt; REPLICA sync: Loading DB in memory</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.150 * Loading RDB produced by version 6.2.11</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.150 * RDB age 0 seconds</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.150 * RDB memory usage when created 2.06 Mb</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.150 # Done loading RDB, keys loaded: 1, keys expired: 0.</span></span>
<span class="line"><span>83156:S 02 Apr 2023 17:33:07.150 * MASTER &lt;-&gt; REPLICA sync: Finished with success</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»èŠ‚ç‚¹æ—¥å¿—ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>83133:M 02 Apr 2023 17:33:07.077 * Replica 127.0.0.1:10086 asks for synchronization</span></span>
<span class="line"><span>83133:M 02 Apr 2023 17:33:07.077 * Partial resynchronization not accepted: Replication ID mismatch (Replica asked for &#39;34d39a331978a925fc9d138919ce80f1f023fc66&#39;, my replication IDs are &#39;baea43cd0b43dde3c2272c616c53431392fd24af&#39; and &#39;0000000000000000000000000000000000000000&#39;)</span></span>
<span class="line"><span>83133:M 02 Apr 2023 17:33:07.077 * Replication backlog created, my new replication IDs are &#39;fc318b44d1f853caaed26b6e608e55d1a09ad2de&#39; and &#39;0000000000000000000000000000000000000000&#39;</span></span>
<span class="line"><span>83133:M 02 Apr 2023 17:33:07.077 * Starting BGSAVE for SYNC with target: disk</span></span>
<span class="line"><span>83133:M 02 Apr 2023 17:33:07.080 * Background saving started by pid 83157</span></span>
<span class="line"><span>83157:C 02 Apr 2023 17:33:07.081 * DB saved on disk</span></span>
<span class="line"><span>83133:M 02 Apr 2023 17:33:07.149 * Background saving terminated with success</span></span>
<span class="line"><span>83133:M 02 Apr 2023 17:33:07.149 * Synchronization with replica 127.0.0.1:10086 succeede</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢çš„æ—¥å¿—å¯ä»¥ç®€å•çœ‹åˆ°ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p><p>éœ€è¦æ³¨æ„ï¼Œ å¯¹äºæ•°æ®é‡è¾ƒå¤§çš„ä¸»èŠ‚ç‚¹ï¼Œ æ¯”å¦‚ç”Ÿæˆçš„ RDB æ–‡ä»¶è¶…è¿‡ 6GB ä»¥ä¸Šæ—¶è¦æ ¼å¤–å°å¿ƒã€‚ ä¼ è¾“æ–‡ä»¶è¿™ä¸€æ­¥æ“ä½œéå¸¸è€—æ—¶ï¼Œ é€Ÿåº¦å–å†³äºä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå¸¦å®½ï¼Œ é€šè¿‡ç»†è‡´åˆ†æ Full resync å’Œ MASTER &lt;-&gt; REPLICA ï¼ˆæ—§ç‰ˆæœ¬æ˜¯ MASTER &lt;-&gt; SLAVEï¼‰è¿™ä¸¤è¡Œæ—¥å¿—çš„æ—¶é—´å·®ï¼Œ å¯ä»¥ç®—å‡º RDB æ–‡ä»¶ä»åˆ›å»ºåˆ°ä¼ è¾“å®Œæ¯•æ¶ˆè€—çš„æ€»æ—¶é—´ã€‚ å¦‚æœæ€»æ—¶é—´è¶…è¿‡ repl-timeout æ‰€é…ç½®çš„å€¼ï¼ˆé»˜è®¤ 60ç§’ï¼‰ï¼Œ ä»èŠ‚ç‚¹å°†æ”¾å¼ƒæ¥å— RDB æ–‡ä»¶å¹¶æ¸…ç†å·²ç»ä¸‹è½½çš„ä¸´æ—¶æ–‡ä»¶ï¼Œ å¯¼è‡´å…¨é‡å¤åˆ¶å¤±è´¥ï¼Œ æ­¤æ—¶ä»èŠ‚ç‚¹æ‰“å°å¦‚ä¸‹æ—¥å¿—ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>83133:M 02 Apr 2023 17:33:10.149 # Timeout receiving bulk data from MASTER... If the problem persists try to set the &#39;repl-timeout&#39; parameter in redis.conf to a larger</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é’ˆå¯¹æ•°æ®é‡è¾ƒå¤§çš„èŠ‚ç‚¹ï¼Œ å»ºè®®è°ƒå¤§ repl-timeout å‚æ•°é˜²æ­¢å‡ºç°å…¨é‡åŒæ­¥æ•°æ®è¶…æ—¶ã€‚</p><p>å®Œæ•´å¤åˆ¶çš„æ—¶é—´å¼€é”€å¦‚ä¸‹ï¼š</p><ul><li>ä¸»èŠ‚ç‚¹ bgsave æ—¶é—´ã€‚</li><li>RDB æ–‡ä»¶ç½‘ç»œä¼ è¾“æ—¶é—´ã€‚</li><li>ä»èŠ‚ç‚¹æ¸…ç©ºæ•°æ®æ—¶é—´ã€‚</li><li>ä»èŠ‚ç‚¹åŠ è½½ RDB çš„æ—¶é—´ã€‚</li><li>å¯èƒ½çš„ AOF é‡å†™æ—¶é—´</li></ul><h4 id="å¤åˆ¶åç§»é‡å’Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒº" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶åç§»é‡å’Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒº"><span>å¤åˆ¶åç§»é‡å’Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒº</span></a></h4><p><strong>ï¼ˆ1ï¼‰ä¸»ä»èŠ‚ç‚¹å„è‡ªçš„å¤åˆ¶åç§»é‡</strong></p><p>å‚ä¸å¤åˆ¶çš„ä¸»ä»èŠ‚ç‚¹éƒ½ä¼šç»´æŠ¤è‡ªèº«å¤åˆ¶åç§»é‡ã€‚ ä¸»èŠ‚ç‚¹ åœ¨å¤„ç†å®Œå†™å…¥å‘½ä»¤åï¼Œ ä¼šæŠŠå‘½ä»¤çš„å­—èŠ‚é•¿åº¦åšç´¯åŠ è®°å½•ï¼Œ ç»Ÿè®¡ä¿¡æ¯åœ¨ info relicationä¸­çš„ master_repl_offset æŒ‡æ ‡ä¸­</p><p>ä»èŠ‚ç‚¹æ¯ç§’ä¸ŠæŠ¥è‡ªèº«çš„å¤åˆ¶åç§»é‡ç»™ä¸»èŠ‚ç‚¹ï¼Œå› æ­¤ä¸»èŠ‚ç‚¹ä¹Ÿä¼šä¿å­˜ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:6379&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">role:master</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">connected_slaves:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave0:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10086,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">online,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">offset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">7924,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">lag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»èŠ‚ç‚¹ä¸ŠæŠ¥çš„å¤åˆ¶åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">.....</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_repl_offset:7924 									</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¸»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">.....</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»èŠ‚ç‚¹åœ¨æ¥æ”¶åˆ°ä¸»èŠ‚ç‚¹å‘é€çš„å‘½ä»¤åï¼Œ ä¹Ÿä¼šç´¯åŠ è®°å½•è‡ªèº«çš„åç§»é‡ã€‚ ç»Ÿè®¡ä¿¡æ¯åœ¨ info relication ä¸­çš„ slave_repl_offset æŒ‡æ ‡ä¸­ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:10086&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">role:slave</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">.....</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave_read_repl_offset:7672</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave_repl_offset:7672</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">.....</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡å¯¹æ¯”ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼Œ å¯ä»¥åˆ¤æ–­ä¸»ä»èŠ‚ç‚¹æ•°æ®æ˜¯å¦ä¸€è‡´ã€‚</p><p><strong>ï¼ˆ2ï¼‰å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</strong></p><p>å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ä¿å­˜åœ¨ä¸»èŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªå›ºå®šé•¿åº¦çš„é˜Ÿåˆ—ï¼Œé»˜è®¤å¤§å°æ˜¯ 1MBï¼Œå½“ä¸»èŠ‚ç‚¹æœ‰é“¾æ¥çš„ä»èŠ‚ç‚¹æ—¶åˆ›å»ºï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å“åº”å†™å‘½ä»¤æ—¶ï¼Œä¸ä½†ä¼šæŠŠå‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿˜ä¼šå†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚</p><p>å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ä¸€ä¸ª FIFO çš„å®šé•¿é˜Ÿåˆ—ï¼Œæ‰€ä»¥èƒ½å®ç°ä¿å­˜æœ€è¿‘å·²å¤åˆ¶æ•°æ®çš„åŠŸèƒ½ï¼Œç”¨äºéƒ¨åˆ†å¤åˆ¶å’Œå¤åˆ¶å‘½ä»¤ä¸¢å¤±çš„æ•°æ®è¡¥æ•‘ã€‚å¤åˆ¶ç¼“å†²åŒºç›¸å…³ç»Ÿè®¡ä¿å­˜åœ¨ä¸»èŠ‚ç‚¹çš„ info replication ä¸­ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:6379&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">.....</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_active:1				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ˜¯å¦å¼€å¯å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_size:1048576			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ç¼“å†²åŒºçš„æœ€å¤§é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_first_byte_offset:1	</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># èµ·å§‹åç§»é‡ï¼Œè®¡ç®—å½“å‰ç¼“å†²åŒºçš„å¯ç”¨èŒƒå›´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_histlen:7924			</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å·²ä¿å­˜æ•°æ®çš„æœ‰æ•ˆé•¿åº¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥é€šè¿‡ repl-backlog-size è®¾ç½®å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°ã€‚</p><p><strong>ï¼ˆ3ï¼‰ psync å‘½ä»¤</strong></p><blockquote><p><a href="https://redis.io/commands/psync/" target="_blank" rel="noopener noreferrer">https://redis.io/commands/psync/</a></p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PSYNC replicationid offset</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€ PSYNC å‘½ä»¤æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šæ ¹æ®è‡ªèº«çš„æƒ…å†µç»™ä»èŠ‚ç‚¹å“åº”</p><ul><li>å®Œæ•´åŒæ­¥ï¼›</li><li>éƒ¨åˆ†åŒæ­¥ï¼›</li><li>ç¬¬ä¸‰ç§æƒ…å†µæ˜¯ä¸»èŠ‚ç‚¹çš„ Redis ç‰ˆæœ¬ä½äº 2.8ï¼Œæ— æ³•è¯†åˆ«psync å‘½ä»¤ï¼Œä»èŠ‚ç‚¹å°†å‘é€æ—§ç‰ˆçš„ sync å‘½ä»¤è§¦å‘å®Œæ•´åŒæ­¥ï¼›</li></ul><h4 id="éƒ¨åˆ†åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#éƒ¨åˆ†åŒæ­¥"><span>éƒ¨åˆ†åŒæ­¥</span></a></h4><p>å½“å› æ•…éšœä¸‹çº¿çš„ä»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€èˆ¬éƒ½ä¸å†ä¸€è‡´ï¼Œå› æ­¤å®ƒä»¬å¿…é¡»è¿›è¡ŒåŒæ­¥ï¼Œè®©ä¸»ä»èŠ‚ç‚¹å†æ¬¡ä¸€è‡´çŠ¶æ€ã€‚Redis 2.8 ä¹‹å‰ï¼Œé‡æ–°åŒæ­¥çš„æ“ä½œéƒ½æ˜¯é€šè¿‡ç›´æ¥è¿›è¡Œå®Œæ•´åŒæ­¥æ¥å®ç°çš„ï¼Œä½†æ˜¯è¿™ç§é‡æ–°åŒæ­¥çš„æ–¹å¼åœ¨ä»èŠ‚ç‚¹çŸ­æš‚ä¸‹çº¿çš„æƒ…å†µä¸‹æ˜¯éå¸¸æµªè´¹èµ„æºçš„ï¼Œå› ä¸ºä¸‹çº¿åå¯èƒ½å°±åªå†™äº†ä¸€ä¸ªå‘½ä»¤ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis 2.8 ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªæ–°çš„åŒæ­¥æ–¹å¼ï¼Œä¸»è¦æ˜¯ PSYNC å‘½ä»¤ï¼š</p><ul><li>å½“ä¸€ä¸ª Redis èŠ‚ç‚¹æˆä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹æ—¶ï¼Œå®ƒä¼šæŠŠæ¯ä¸ªè¢«æ‰§è¡Œçš„å†™å‘½ä»¤éƒ½è®°å½•åˆ°ä¸€ä¸ªç‰¹å®šé•¿åº¦çš„ FIFO é˜Ÿåˆ—ä¸­ï¼›</li><li>å½“ä¸‹çº¿çš„ä»èŠ‚ç‚¹å°è¯•é‡æ–°è¿æ¥ä¸»èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸»èŠ‚ç‚¹å°†æ£€æŸ¥ä»èŠ‚ç‚¹ä¸‹çº¿æœŸé—´ï¼Œè¢«æ‰§è¡Œçš„é‚£äº›å†™å‘½ä»¤æ˜¯å¦ä»ç„¶ä¿å­˜åœ¨é˜Ÿåˆ—é‡Œé¢ã€‚ <ul><li>å¦‚æœåœ¨é˜Ÿåˆ—é‡Œé¢ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å°±ä¼šç›´æ¥æŠŠä»èŠ‚ç‚¹ç¼ºå¤±çš„é‚£äº›å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹æ‰§è¡Œï¼Œä»èŠ‚ç‚¹é€šè¿‡æ‰§è¡Œè¿™äº›å†™å‘½ä»¤å°±å¯ä»¥é‡æ–°å’Œä¸»èŠ‚ç‚¹ä¿æŒä¸€è‡´çš„çŠ¶æ€ï¼›</li><li>å¦‚æœä¸åœ¨é˜Ÿåˆ—é‡Œé¢ï¼Œé‚£ä¹ˆä¸»ä»æœåŠ¡å™¨ä¼šè¿›è¡Œä¸€æ¬¡å®Œæ•´åŒæ­¥ï¼›</li></ul></li></ul><img src="/assets/image-20230402180412596-BD7U2fjd.png" alt="image-20230402180412596" style="zoom:50%;"><p>éƒ¨åˆ†åŒæ­¥çš„æµç¨‹</p><ul><li><p>å½“ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå‡ºç°ä¸­æ–­æ—¶ï¼Œå¦‚æœè¶…è¿‡äº† repl-timeout æ—¶é—´ï¼Œä¸»èŠ‚ç‚¹ä¼šè®¤ä¸ºä»å°†è¯¶ç‚¹æ•…éšœå¹¶ä¸­æ–­å¤åˆ¶è¿æ¥</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>83133:M 02 Apr 2023 18:05:18.660 # Connection with replica 127.0.0.1:10086 lost.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœæ­¤æ¬¡ä»èŠ‚ç‚¹æ²¡æœ‰å®•æœºï¼Œä¹Ÿä¼šæ‰“å°è¿æ¥ä¸¢å¤±æ—¥å¿—</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>85503:S 02 Apr 2023 18:08:52.177 # Connection with master lost.</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:08:52.177 * Caching the disconnected master state.</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:08:52.177 * Reconnecting to MASTER 127.0.0.1:6379</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:08:52.177 * MASTER &lt;-&gt; REPLICA sync started</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:08:52.177 # Error condition on socket for SYNC: Connection refused</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸»ä»è¿æ¥ä¸­æ–­æœŸé—´ä¸»èŠ‚ç‚¹ä¾ç„¶å“åº”å‘½ä»¤ï¼Œä½†æ˜¯å› ä¸ºå¤åˆ¶è¿æ¥ä¸­æ–­å‘½ä»¤æ— æ³•å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¸è¿‡ä¸»èŠ‚ç‚¹å†…éƒ¨å­˜åœ¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œä¾ç„¶å¯ä»¥ä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å†™å‘½ä»¤æ•°æ®ï¼Œé»˜è®¤æœ€å¤§ç¼“å­˜ 1MBã€‚</p></li><li><p>å½“ä¸»ä»èŠ‚ç‚¹ç½‘ç»œæ¢å¤åï¼Œä»èŠ‚ç‚¹ä¼šå†æ¬¡è¿æ¥ä¸Šä¸»èŠ‚ç‚¹ï¼Œ</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>85503:S 02 Apr 2023 18:09:44.039 * Connecting to MASTER 127.0.0.1:6379</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:09:44.039 * MASTER &lt;-&gt; REPLICA sync started</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:09:44.039 * Non blocking connect for SYNC fired the event.</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:09:44.039 * Master replied to PING, replication can continue...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å½“ä¸»ä»è¿æ¥æ¢å¤åï¼Œç”±äºä»èŠ‚ç‚¹ä¹‹å‰ä¿å­˜äº†è‡ªèº«å·²å¤åˆ¶çš„åç§»é‡å’Œä¸»èŠ‚ç‚¹çš„å¤åˆ¶ idã€‚å› æ­¤ä¼šæŠŠå®ƒä»¬å½“åš psync å‚æ•°å‘é€ç»™ä¸»èŠ‚ç‚¹ï¼Œè¦æ±‚å°±è¡Œéƒ¨åˆ†åŒæ­¥æ“ä½œï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>85503:S 02 Apr 2023 18:09:44.040 * Trying a partial resynchronization (request fc318b44d1f853caaed26b6e608e55d1a09ad2de:2689).</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>ä¸»èŠ‚ç‚¹æ¥åˆ° psync å‘½ä»¤åé¦–å…ˆæ ¸å¯¹å‚æ•°å¤åˆ¶ id æ˜¯å¦ä¸è‡ªèº«ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™è¯´æ˜ä¹‹å‰å¤åˆ¶çš„å°±æ˜¯å½“å‰ä¸»èŠ‚ç‚¹ã€‚ä¹‹åæ ¹æ®å‚æ•° offset åœ¨è‡ªèº«å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­æŸ¥æ‰¾ï¼Œå¦‚æœåç§»é‡ä¹‹åçš„æ•°æ®å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œåˆ™å¯¹ä»èŠ‚ç‚¹å“åº”å¯ä»¥è¿›è¡Œéƒ¨åˆ†åŒæ­¥ã€‚ä»èŠ‚ç‚¹æ¥åˆ°å›å¤åæ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>85503:S 02 Apr 2023 18:09:44.041 * Successful partial resynchronization with master.</span></span>
<span class="line"><span>85503:S 02 Apr 2023 18:09:44.041 * MASTER &lt;-&gt; REPLICA sync: Master accepted a Partial Resynchronization.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸»èŠ‚ç‚¹æ ¹æ®åç§»é‡æŠŠå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œçš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»å¤åˆ¶è¿›å…¥æ­£å¸¸çŠ¶æ€ã€‚å‘é€çš„æ•°æ®é‡å¯ä»¥åœ¨ä¸»èŠ‚ç‚¹çš„æ—¥å¿—ä¸­è·å–ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>82913:M 02 Apr 2023 18:09:44.031 * Replica 127.0.0.1:10086 asks for synchronization</span></span>
<span class="line"><span>82913:M 02 Apr 2023 18:09:44.031 * Partial resynchronization request from 127.0.0.1:10086 accepted. Sending 39 bytes of backlog starting from offset 2689.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="åœ¨çº¿å¼‚æ­¥æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#åœ¨çº¿å¼‚æ­¥æ›´æ–°"><span>åœ¨çº¿å¼‚æ­¥æ›´æ–°</span></a></h4><p>å½“ä¸»èŠ‚ç‚¹æŠŠå½“å‰çš„æ•°æ®åŒæ­¥ç»™ä»èŠ‚ç‚¹åï¼Œä¾¿å®Œæˆäº†å¤åˆ¶çš„å»ºç«‹æµç¨‹ã€‚æ¥ä¸‹æ¥æ¯å½“ä¸»èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤åï¼Œå°±ä¼šå°†ç›¸åŒçš„å†™å‘½ä»¤æˆ–è€…å…·æœ‰ç›¸åŒæ•ˆæœçš„å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹æ‰§è¡Œï¼›</p><p>å› ä¸ºæ˜¯å¼‚æ­¥æ›´æ–°ï¼Œæ‰€ä»¥ä¸»èŠ‚ç‚¹åœ¨æ‰§è¡Œå®Œå†™å‘½ä»¤ä¹‹åç›´åˆ°ä»èŠ‚ç‚¹ä¹Ÿæ‰§è¡Œå®Œç›¸åŒå†™å‘½ä»¤çš„è¿™æ®µæ—¶é—´é‡Œï¼Œä¸»ä»èŠ‚ç‚¹çš„æ•°æ®åº“å°†å‡ºç°çŸ­æš‚çš„ä¸ä¸€è‡´ï¼Œå› æ­¤è¦æ±‚å¼ºä¸€è‡´æ€§çš„ç¨‹åºå¯èƒ½éœ€è¦ç›´æ¥è¯»å–ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚æ‰€ä»¥ Redis çš„å¤åˆ¶åŠŸèƒ½æ˜¯æ— æ³•æœç»ä¸ä¸€è‡´çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ info replication æŸ¥çœ‹å¤åˆ¶å»¶è¿Ÿäº†å¤šå°‘</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:6379&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">role:master</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">connected_slaves:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave0:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10086,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">online,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">offset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1778,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">lag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid:8909d9d2679658bbd539da23ca2f242428fcb25d</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid2:0000000000000000000000000000000000000000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_repl_offset:1778</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_first_byte_offset:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_histlen:1778</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹ slave0 çš„ä¿¡æ¯ï¼Œè®°å½•äº†ä»èŠ‚ç‚¹çš„ ip ã€ç«¯å£ã€ä»èŠ‚ç‚¹çš„çŠ¶æ€ã€å½“å‰ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ã€lag è¡¨ç¤ºå»¶è¿Ÿã€‚</p><p>master_repl_offset è¡¨ç¤ºå½“å‰ä¸»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼Œä¸¤è€…çš„å·®å€¼å°±æ˜¯å½“å‰ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ã€‚</p><h4 id="å¿ƒè·³ä¿æŒ" tabindex="-1"><a class="header-anchor" href="#å¿ƒè·³ä¿æŒ"><span>å¿ƒè·³ä¿æŒ</span></a></h4><p>ä»èŠ‚ç‚¹é€šè¿‡å‘½ä»¤ <code>REPLCONF ACK &lt;reploff&gt;</code> æ¯ç§’å‘ä¸»æœåŠ¡å™¨æ±‡æŠ¥è‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼Œä¸»èŠ‚ç‚¹å­˜å‚¨æ¥æ”¶åˆ°è¯¥å‘½ä»¤çš„æ—¶é—´ï¼Œä»¥æ­¤ä½œä¸ºæ£€æµ‹ä»èŠ‚ç‚¹æ˜¯å¦æœ‰æ•ˆçš„æ ‡å‡†ã€‚repl_timeout è¡¨ç¤ºä¸»ä»æœåŠ¡å™¨è¶…æ—¶æ—¶é—´ï¼Œç”¨æˆ·å¯é€šè¿‡å‚æ•°repl-timeouté…ç½®ï¼Œé»˜è®¤ä¸º60ï¼Œå•ä½ç§’ï¼Œè¶…è¿‡æ­¤æ—¶é—´åˆ™è®¤ä¸ºä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å‡ºç°æ•…éšœï¼Œä»æœåŠ¡å™¨ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚</p><p>ä¸»ä»å¿ƒè·³æœºåˆ¶ï¼š</p><ul><li>ä¸»ä»èŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œå„è‡ªæ¨¡æ‹Ÿæˆå¯¹æ–¹çš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡ client list å‘½ä»¤å¯ä»¥æŸ¥çœ‹å¤åˆ¶ç›¸å…³çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä¸»èŠ‚ç‚¹çš„è¿æ¥çŠ¶æ€ä¸º flags=Mï¼Œä»èŠ‚ç‚¹è¿æ¥çŠ¶æ€ä¸º flags=Sï¼›</li><li>ä¸»èŠ‚ç‚¹é»˜è®¤æ¯éš” 10 ç§’å¯¹ä»èŠ‚ç‚¹å‘é€ ping å‘½ä»¤ï¼Œåˆ¤æ–­ä»èŠ‚ç‚¹çš„å­˜æ´»æ€§å’Œè¿æ¥çŠ¶æ€ã€‚å¯é€šè¿‡ repl-ping-slave-period è®¾ç½®å‘é€é¢‘ç‡ï¼›</li><li>ä»èŠ‚ç‚¹åœ¨ä¸»çº¿ç¨‹ä¸­æ¯éš” 1 ç§’å‘é€ <code>REPLCONF ACK &lt;reploff&gt;</code> å‘½ä»¤ï¼Œå‘ä¸»æœåŠ¡å™¨æ±‡æŠ¥è‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼›</li></ul><p><code>REPLCONF ACK &lt;reploff&gt;</code> å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼š</p><ul><li>å®æ—¶æ£€æµ‹ä¸»ä»èŠ‚ç‚¹ç½‘ç»œçŠ¶æ€ï¼›</li><li>ä¸ŠæŠ¥è‡ªèº«å¤åˆ¶åç§»é‡ï¼Œæ£€æŸ¥å¤åˆ¶æ•°æ®æ˜¯å¦ä¸¢å¤±ï¼Œå¦‚æœä»èŠ‚ç‚¹æ•°æ®ä¸¢å¤±ï¼Œå†ä»ä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºä¸­æ‹‰å–ä¸¢å¤±æ•°æ®ï¼›</li><li>å®ç°ä¿è¯ä»èŠ‚ç‚¹çš„æ•°é‡å’Œå»¶è¿Ÿæ€§åŠŸèƒ½ï¼Œé€šè¿‡ min-slaves-to-write å’Œ min-slaves-max-lag å‚æ•°é…ç½®å®šä¹‰ï¼›</li></ul><h4 id="æ— ç›˜å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#æ— ç›˜å¤åˆ¶"><span>æ— ç›˜å¤åˆ¶</span></a></h4><p>å‰é¢è¯´è¿‡ï¼Œä¸»èŠ‚ç‚¹åœ¨è¿›è¡Œå®Œæ•´åŒæ­¥çš„æ—¶å€™ï¼Œéœ€è¦åœ¨æœ¬åœ°åˆ›å»º RDB æ–‡ä»¶ï¼Œç„¶åé€šè¿‡å¥—æ¥å­—å°†è¿™ä¸ª RDB æ–‡ä»¶ä¼ è¾“ç»™ä»èŠ‚ç‚¹ã€‚ä½†æ˜¯å¦‚æœä¸»èŠ‚ç‚¹åˆ›å»º RDB æ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªè€—æ€§èƒ½çš„æ“ä½œã€‚</p><p>Redis 2.8.18 å¼•å…¥è¯¯åˆ¤å¤åˆ¶æ“ä½œï¼ˆdiskless replicationï¼‰ï¼Œå¼€å¯äº†è¿™ä¸ªç‰¹æ€§çš„ä¸»èŠ‚ç‚¹åœ¨æ¥æ”¶åˆ° replicaof / slaveof å‘½ä»¤æ—¶å°†ä¸å†åœ¨æœ¬åœ°åˆ›å»º RDB æ–‡ä»¶ï¼Œè€Œæ˜¯ä¼š fork ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åç”±å­è¿›ç¨‹é€šè¿‡å¥—æ¥å­—ç›´æ¥å°† RDB æ–‡ä»¶å†™å…¥ä»èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸»èŠ‚ç‚¹å°±å¯ä»¥åœ¨ä¸åˆ›å»º RDB æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œå®Œæˆå’Œä»èŠ‚ç‚¹çš„æ•°æ®åŒæ­¥ã€‚</p><p>é…ç½®é¡¹ repl-diskless-sync å¼€å¯æ— ç›˜å¤åˆ¶</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>repl-diskless-sync yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="å¤åˆ¶å¯èƒ½å‡ºç°çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶å¯èƒ½å‡ºç°çš„é—®é¢˜"><span>å¤åˆ¶å¯èƒ½å‡ºç°çš„é—®é¢˜</span></a></h2><h3 id="ä¸»ä»æ•°æ®å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»æ•°æ®å»¶è¿Ÿ"><span>ä¸»ä»æ•°æ®å»¶è¿Ÿ</span></a></h3><p>å› ä¸ºå¤åˆ¶æ˜¯é€šè¿‡å¼‚æ­¥æ“ä½œçš„ï¼Œæ‰€ä»¥ä¸»ä»èŠ‚ç‚¹ä¹‹åè‚¯å®šä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚å»¶è¿Ÿå–å†³äºç½‘ç»œå¸¦å®½å’Œå‘½ä»¤é˜»å¡çš„æƒ…å†µï¼Œéœ€è¦ä¸šåŠ¡åœºæ™¯å…è®¸çŸ­æ—¶é—´çš„æ•°æ®å»¶è¿Ÿã€‚ä¸ºäº†å°½å¯èƒ½çš„é™ä½æ•°æ®ä¸ä¸€è‡´å‡ºç°çš„æ¦‚ç‡ï¼ŒRedis ä» 2.8 å¼€å§‹å¼•å…¥äº†ä¸¤ä¸ªé…ç½®é¡¹</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>min-slaves-to-write 3</span></span>
<span class="line"><span>min-slaves-max-lag 10</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®è¿™ä¸¤ä¸ªé€‰é¡¹åï¼Œä¸»èŠ‚ç‚¹åªä¼šåœ¨ä»èŠ‚ç‚¹å¤§äºç­‰äº min-slaves-to-write çš„å€¼ï¼Œå¹¶ä¸”è¿™äº›ä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹æœ€åä¸€æ¬¡æˆåŠŸé€šä¿¡çš„æ—¶é—´é—´éš”ä¸è¶…è¿‡ min-slaves-max-lag çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œå†™å‘½ä»¤ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥è®©ä¸»èŠ‚ç‚¹åªåœ¨ä¸»ä»æœåŠ¡å™¨è¿æ¥è‰¯å¥½çš„æƒ…å†µä¸‹æ‰§è¡Œå†™å‘½ä»¤ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å°‘å› ä¸ºä¸»ä»èŠ‚ç‚¹è¿æ¥ä¸ç¨³å®šè€Œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œå¹¶é™ä½å› ä¸ºæ²¡æœ‰ä»èŠ‚ç‚¹å¯ç”¨è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚</p><p>å¯¹åº”äºæ— æ³•å®¹å¿å¤§é‡å»¶è¿Ÿåœºæ™¯ï¼Œ å¯ä»¥ç¼–å†™å¤–éƒ¨ç›‘æ§ç¨‹åºç›‘å¬ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼Œ å½“å»¶è¿Ÿè¾ƒå¤§æ—¶è§¦å‘æŠ¥è­¦æˆ–è€…é€šçŸ¥å®¢æˆ·ç«¯é¿å…è¯»å–å»¶è¿Ÿè¿‡é«˜çš„ä»èŠ‚ç‚¹ã€‚</p><p>åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œ info replication å‘½ä»¤ä¸­ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1:6379&gt; info replication</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">role:master</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">connected_slaves:2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave0:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10086,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">online,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">offset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">23447,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">lag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">slave1:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">127.0.0.1,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">online,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">offset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">0,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">lag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">15417</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid:8909d9d2679658bbd539da23ca2f242428fcb25d</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_replid2:0000000000000000000000000000000000000000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">master_repl_offset:23447</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_first_byte_offset:1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">repl_backlog_histlen:23447</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>master_repl_offset æ˜¯ä¸»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼Œslave0 å’Œ slave1 ä¸­å­˜çš„æ˜¯ä»èŠ‚ç‚¹çš„ä¸€äº›ä¿¡æ¯ã€‚å¯ä»¥ç›‘æ§ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡çš„å·®å€¼ã€‚</p><h3 id="ä»èŠ‚ç‚¹çš„è¿‡æœŸæ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä»èŠ‚ç‚¹çš„è¿‡æœŸæ•°æ®"><span>ä»èŠ‚ç‚¹çš„è¿‡æœŸæ•°æ®</span></a></h3><p>å½“ä¸»èŠ‚ç‚¹å­˜å‚¨å¤§é‡è®¾ç½®è¶…æ—¶çš„æ•°æ®æ—¶ï¼ŒRedis éœ€è¦ç»´æŠ¤è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥ã€‚ä¸»è¦æ˜¯æƒ°æ€§åˆ é™¤å’Œå®šæ—¶åˆ é™¤ã€‚</p><ul><li>æƒ°æ€§åˆ é™¤ï¼šä¸»èŠ‚ç‚¹æ¯æ¬¡å¤„ç†è¯»å‘½ä»¤æ—¶ï¼Œä¼šæ£€æŸ¥é”®æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶åˆ™æ‰§è¡Œ del å‘½ä»¤åˆ é™¤é”®å¯¹è±¡ï¼Œä¹‹å del å‘½ä»¤ä¹Ÿä¼šå¼‚æ­¥å‘é€ç»™ä»èŠ‚ç‚¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸ºäº†ä¿è¯å¤åˆ¶çš„ä¸€è‡´æ€§ï¼Œä»èŠ‚ç‚¹è‡ªèº«æ°¸è¿œä¸ä¼šä¸»åŠ¨åˆ é™¤è¶…æ—¶æ•°æ®ï¼›</li><li>å®šæ—¶åˆ é™¤ï¼šRedis ä¸»èŠ‚ç‚¹åœ¨å†…éƒ¨å®šæ—¶ä»»åŠ¡ä¼šå¾ªç¯é‡‡æ ·ä¸€å®šæ•°é‡çš„é”®ï¼Œå½“å‘ç°é‡‡æ ·çš„é”®è¿‡æœŸæ—¶æ‰§è¡Œ del å‘½ä»¤ï¼Œä¹‹åå†åŒæ­¥ç»™ä»èŠ‚ç‚¹ï¼›</li></ul><p>é˜è¿°é—®é¢˜ï¼š</p><ul><li>ä»èŠ‚ç‚¹ä¸ä¼šä½¿é”®è¿‡æœŸï¼Œè€Œæ˜¯ç­‰å¾…ä¸»èŠ‚ç‚¹ä½¿é”®è¿‡æœŸã€‚å½“ä¸»èŠ‚ç‚¹ä½¿é”®è¿‡æœŸï¼ˆæˆ–ç”±äº LRU è€Œå°†å…¶é€å‡ºï¼‰æ—¶ï¼Œå®ƒä¼šåˆæˆä¸€ä¸ª<a href="https://redis.io/commands/del" target="_blank" rel="noopener noreferrer"><code>DEL</code></a>å‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†ä¼ è¾“åˆ°æ‰€æœ‰ä»èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæ­¤æ—¶æ•°æ®å¤§é‡è¶…æ—¶ï¼Œä¸»æœºç‚¹çš„é‡‡æ ·é€Ÿåº¦è·Ÿä¸ä¸Šè¿‡æœŸé€Ÿåº¦ä¸”ä¸»èŠ‚ç‚¹æ²¡æœ‰è¯»å–è¿‡æœŸé”®çš„æ“ä½œï¼Œé‚£ä¹ˆä»èŠ‚ç‚¹å°†æ— æ³•æ”¶åˆ° del å‘½ä»¤ã€‚è¿™æ˜¯åœ¨ä»èŠ‚ç‚¹ä¸Šå¯ä»¥è¯»å–åˆ°å·²ç»è¶…æ—¶çš„æ•°æ®ã€‚Redis åœ¨ 3.2 ç‰ˆæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä»èŠ‚ç‚¹è¯»å–æ•°æ®ä¹‹å‰ä¼šæ£€æŸ¥é”®çš„è¿‡æœŸæ—¶é—´æ¥å†³å®šæ˜¯å¦è¿”å›æ•°æ®ï¼›</li></ul><h3 id="ä¸»ä»é…ç½®ä¸ä¸€è‡´" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»é…ç½®ä¸ä¸€è‡´"><span>ä¸»ä»é…ç½®ä¸ä¸€è‡´</span></a></h3><p>é«˜ç‰ˆæœ¬çš„ Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä»èŠ‚ç‚¹å°†å¿½ç•¥ maxmemoryï¼ˆé™¤éå®ƒåœ¨æ•…éšœè½¬ç§»åæˆ–æ‰‹åŠ¨æå‡ä¸ºä¸»ï¼‰ã€‚è¿™æ„å‘³ç€é”®çš„é€å‡ºå°†ç”±ä¸»èŠ‚ç‚¹å¤„ç†ï¼Œå°† DEL å‘½ä»¤å‘é€åˆ°ä»èŠ‚ç‚¹ï¼Œä½œä¸ºä¸»æœèŠ‚ç‚¹ç«¯çš„é”®é€å‡ºã€‚</p><p>è¦æ›´æ”¹æ­¤è¡Œä¸ºï¼Œæ‚¨å¯ä»¥å…è®¸å‰¯æœ¬ä¸å¿½ç•¥ maxmemoryï¼Œè¦ä½¿ç”¨çš„é…ç½®æŒ‡ä»¤æ˜¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>replica-ignore-maxmemory no</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸»ä»é…ç½®ä¸ä¸€è‡´æ˜¯ä¸€ä¸ªå®¹æ˜“å¿½è§†çš„é—®é¢˜ã€‚ å¯¹äºæœ‰äº›é…ç½®ä¸»ä»ä¹‹é—´æ˜¯å¯ä»¥ä¸ä¸€è‡´ï¼Œ æ¯”å¦‚ï¼š ä¸»èŠ‚ç‚¹å…³é—­ AOF åœ¨ä»èŠ‚ç‚¹å¼€å¯ã€‚ ä½†å¯¹äºå†…å­˜ç›¸å…³çš„é…ç½®å¿…é¡»è¦ä¸€è‡´ï¼Œ æ¯”å¦‚ maxmemoryï¼Œ hash-max-ziplist-entries ç­‰å‚æ•°ã€‚ å½“é…ç½®çš„ maxmemory ä»èŠ‚ç‚¹å°äºä¸»èŠ‚ç‚¹ï¼Œ å¦‚æœå¤åˆ¶çš„æ•°æ®é‡è¶…è¿‡ä»èŠ‚ç‚¹ maxmemory æ—¶ï¼Œ å®ƒä¼šæ ¹æ® maxmemory-policy ç­–ç•¥è¿›è¡Œå†…å­˜æº¢å‡ºæ§åˆ¶ï¼Œ æ­¤æ—¶ä»èŠ‚ç‚¹æ•°æ®å·²ç»ä¸¢å¤±ï¼Œ ä½†ä¸»ä»å¤åˆ¶æµç¨‹ä¾ç„¶æ­£å¸¸è¿›è¡Œï¼Œ å¤åˆ¶åç§»é‡ä¹Ÿæ­£å¸¸ã€‚ ä¿®å¤è¿™ç±»é—®é¢˜ä¹Ÿåªèƒ½æ‰‹åŠ¨è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚ å½“å‹ç¼©åˆ—è¡¨ç›¸å…³å‚æ•°ä¸ä¸€è‡´æ—¶ï¼Œ è™½ç„¶ä¸»ä»èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®ä¸€è‡´ä½†å®é™…å†…å­˜å ç”¨æƒ…å†µå·®å¼‚ä¼šæ¯”è¾ƒå¤§ã€‚</p><h3 id="é¿å…å®Œæ•´åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#é¿å…å®Œæ•´åŒæ­¥"><span>é¿å…å®Œæ•´åŒæ­¥</span></a></h3><p>å› ä¸ºå®Œæ•´åŒæ­¥æ˜¯ä¸€ä¸ªéå¸¸è€—æ€§èƒ½çš„æ“ä½œï¼Œç¬¬ä¸€æ¬¡å»ºç«‹å¤åˆ¶çš„æ—¶å€™åº”è¯¥åœ¨ä¸šåŠ¡ä½å³°æœŸçš„æ—¶å€™è¿›è¡Œã€‚</p><p>å½“ä¸»ä»èŠ‚ç‚¹æ–­å¼€åï¼Œå†æ¬¡å»ºç«‹è¿æ¥æ—¶ä»èŠ‚ç‚¹ä¼šå‘é€ psync åˆ°ä¸»èŠ‚ç‚¹è¯·æ±‚éƒ¨åˆ†åŒæ­¥ï¼Œå¦‚æœè¯·æ±‚çš„å¤åˆ¶åç§»é‡ä¸åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ä¹Ÿä¼šè¿›è¡Œå®Œæ•´åŒæ­¥ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§æƒ…å†µéœ€è¦æ ¹æ®ç½‘ç»œä¸­æ–­æ—¶é•¿ï¼Œ å†™å‘½ä»¤æ•°æ®é‡åˆ†æå‡ºåˆç†<br> çš„ç§¯å‹ç¼“å†²åŒºå¤§å°ã€‚ ç½‘ç»œä¸­æ–­ä¸€èˆ¬æœ‰é—ªæ–­ã€ æœºæˆ¿å‰²æ¥ã€ ç½‘ç»œåˆ†åŒºç­‰æƒ…å†µã€‚ è¿™æ—¶ç½‘ç»œä¸­æ–­çš„æ—¶é•¿ä¸€èˆ¬åœ¨åˆ†é’Ÿçº§ã€‚ å†™å‘½ä»¤æ•°æ®é‡å¯ä»¥ç»Ÿè®¡é«˜å³°æœŸä¸»èŠ‚ç‚¹æ¯ç§’ info replication çš„ master_repl_offset å·®å€¼è·å–ã€‚ç§¯å‹ç¼“å†²åŒºé»˜è®¤ä¸º1MBï¼Œ å¯¹äºå¤§æµé‡åœºæ™¯æ˜¾ç„¶ä¸å¤Ÿï¼Œ è¿™æ—¶éœ€è¦å¢å¤§ç§¯å‹ç¼“å†²åŒºã€‚</p><p>é…ç½®é¡¹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>repl-backlog-size 1mb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="é¿å…å¤åˆ¶é£æš´" tabindex="-1"><a class="header-anchor" href="#é¿å…å¤åˆ¶é£æš´"><span>é¿å…å¤åˆ¶é£æš´</span></a></h3><p>å¤åˆ¶é£æš´æ˜¯æŒ‡å¤§é‡ä»èŠ‚ç‚¹å¯¹åŒä¸€ä¸»èŠ‚ç‚¹æˆ–è€…å¯¹åŒä¸€å°æœºå™¨çš„å¤šä¸ªä¸»èŠ‚ç‚¹çŸ­æ—¶é—´å†…å‘èµ·å…¨é‡å¤åˆ¶çš„è¿‡ç¨‹ã€‚ å¤åˆ¶é£æš´å¯¹å‘èµ·å¤åˆ¶çš„ä¸»èŠ‚ç‚¹æˆ–è€…æœºå™¨é€ æˆå¤§é‡å¼€é”€ï¼Œ å¯¼è‡´CPUã€ å†…å­˜ã€ å¸¦å®½æ¶ˆè€—ã€‚ å› æ­¤æˆ‘ä»¬åº”è¯¥åˆ†æå‡ºå¤åˆ¶é£æš´å‘ç”Ÿçš„åœºæ™¯ï¼Œ æå‰é‡‡ç”¨åˆç†çš„æ–¹å¼è§„é¿ã€‚ è§„é¿æ–¹å¼æœ‰å¦‚ä¸‹å‡ ä¸ª</p><p>å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´ä¸€èˆ¬å‘ç”Ÿåœ¨ä¸»èŠ‚ç‚¹æŒ‚è½½å¤šä¸ªä»èŠ‚ç‚¹çš„åœºæ™¯ã€‚ å½“ä¸»èŠ‚ç‚¹é‡å¯æ¢å¤åï¼Œ ä»èŠ‚ç‚¹ä¼šå‘èµ·å…¨é‡å¤åˆ¶æµç¨‹ï¼Œ è¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šä¸ºä»èŠ‚ç‚¹åˆ›å»ºRDBå¿«ç…§ï¼Œ å¦‚æœåœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰ï¼Œ æœ‰å¤šä¸ªä»èŠ‚ç‚¹éƒ½å°è¯•ä¸ä¸»èŠ‚ç‚¹è¿›è¡Œå…¨é‡åŒæ­¥ï¼Œ é‚£ä¹ˆå…¶ä»–ä»èŠ‚ç‚¹å°†å…±äº«è¿™ä»½RDBå¿«ç…§ã€‚ è¿™ç‚¹Redisåšäº†ä¼˜åŒ–ï¼Œ æœ‰æ•ˆé¿å…äº†åˆ›å»ºå¤šä¸ªå¿«ç…§ã€‚ ä½†æ˜¯ï¼Œ åŒæ—¶å‘å¤šä¸ªä»èŠ‚ç‚¹å‘é€RDBå¿«ç…§ï¼Œ å¯èƒ½ä½¿ä¸»èŠ‚ç‚¹çš„ç½‘ç»œå¸¦å®½æ¶ˆè€—ä¸¥é‡ï¼Œ é€ æˆä¸»èŠ‚ç‚¹çš„å»¶è¿Ÿå˜å¤§ï¼Œ æç«¯æƒ…å†µä¼šå‘ç”Ÿä¸»ä»èŠ‚ç‚¹<br> è¿æ¥æ–­å¼€ï¼Œ å¯¼è‡´å¤åˆ¶å¤±è´¥ã€‚</p><p>Redis åšçš„ä¼˜åŒ–ï¼š</p><ul><li>å¦‚æœä¸»èŠ‚ç‚¹åœ¨æ”¶åˆ° replicaofã€slaveof å‘½ä»¤ä¹‹å‰ï¼Œå·²ç»åˆ›å»ºäº† RDBï¼Œå¹¶ä¸”å®ƒåœ¨åˆ›å»ºè¿™ä¸ª RDB æ–‡ä»¶ä¹‹åæ²¡æœ‰å†™å‘½ä»¤ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹ç›´æ¥å‘ä»èŠ‚ç‚¹å‘é€å·²æœ‰çš„ RDB æ–‡ä»¶ã€‚</li><li>å¦‚æœåœ¨ä¸»èŠ‚ç‚¹åˆ›å»º RDB æœŸé—´æœ‰å¤šä¸ªä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€æ•°æ®åŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹ä¼šå°†å‘ç”Ÿè¯·æ±‚çš„ä»èŠ‚ç‚¹å…¨éƒ¨æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç­‰åˆ° RDB æ–‡ä»¶åˆ›å»ºå®Œæ¯•åï¼Œå†æŠŠå®ƒå‘ç»™é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»èŠ‚ç‚¹ã€‚</li></ul><p>è§£å†³æ–¹æ¡ˆé¦–å…ˆå¯ä»¥å‡å°‘ä¸»èŠ‚ç‚¹æŒ‚è½½ä»èŠ‚ç‚¹çš„æ•°é‡ï¼Œæˆ–è€…é‡‡ç”¨æ ‘çŠ¶å¤åˆ¶ç»“æ„ï¼Œ åŠ å…¥ä¸­é—´å±‚ä»èŠ‚ç‚¹ç”¨æ¥ä¿æŠ¤ä¸»èŠ‚ç‚¹ï¼Œ</p><img src="/assets/image-20230402230929991-CkKA-HAF.png" alt="image-20230402230929991" style="zoom:50%;"><h3 id="master-å…³é—­æŒä¹…æ€§æ—¶å¤åˆ¶çš„å®‰å…¨æ€§" tabindex="-1"><a class="header-anchor" href="#master-å…³é—­æŒä¹…æ€§æ—¶å¤åˆ¶çš„å®‰å…¨æ€§"><span>master å…³é—­æŒä¹…æ€§æ—¶å¤åˆ¶çš„å®‰å…¨æ€§</span></a></h3><p>åœ¨ä½¿ç”¨ Redis å¤åˆ¶çš„è®¾ç½®ä¸­ï¼Œå¼ºçƒˆå»ºè®®åœ¨ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ä¸­æ‰“å¼€æŒä¹…æ€§ã€‚</p><p>å‡å¦‚ä¸»èŠ‚ç‚¹ä¸æ‰“å¼€æŒä¹…æ€§ï¼Œå‡å¦‚ç”±äºéå¸¸æ…¢çš„ç£ç›˜æ“ä½œå¼•èµ·çš„å»¶è¿Ÿé—®é¢˜ï¼Œä¸»èŠ‚ç‚¹åº”è¯¥è¢«é…ç½®ä¸ºé¿å…åœ¨è„±æœºå**è‡ªåŠ¨é‡å¯ã€‚**å› ä¸ºä¸»èŠ‚ç‚¹æ²¡æœ‰ä¿å­˜æŒä¹…åŒ–æ–‡ä»¶ï¼Œå®ƒé‡å¯åæ•°æ®åº“éƒ½æ˜¯ç©ºçš„ï¼Œè¿™æ—¶æ‰€æœ‰çš„ä»èŠ‚ç‚¹éƒ½ä¼šå‘èµ·ä¸€æ¬¡å…¨é‡åŒæ­¥ï¼Œè¿™æ ·æçš„æ‰€æœ‰ä»èŠ‚ç‚¹éƒ½æ²¡æ•°æ®äº†ã€‚</p><ol><li><p>å‡å¦‚èŠ‚ç‚¹ A å……å½“ä¸»èŠ‚ç‚¹ï¼ŒæŒä¹…æ€§è¢«å…³é—­ï¼ŒèŠ‚ç‚¹ B å’Œ C ä»èŠ‚ç‚¹ A å¤åˆ¶ï¼›</p></li><li><p>å‡å¦‚èŠ‚ç‚¹ A å´©æºƒäº†ï¼Œå‡å¦‚é…ç½®äº†è‡ªåŠ¨é‡å¯ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå¯ä»¥é‡å¯è¿›ç¨‹ã€‚ä½†æ˜¯ä¸»èŠ‚ç‚¹ A ç”±äºæŒä¹…æ€§å…³é—­äº†ï¼Œå› æ­¤èŠ‚ç‚¹ä¼šä»¥ç©ºæ•°æ®é›†é‡æ–°å¯åŠ¨ï¼›</p></li><li><p>èŠ‚ç‚¹ B å’Œ C å°†ä»ç©ºçš„èŠ‚ç‚¹ A è¿›è¡Œå¤åˆ¶ï¼Œå› æ­¤å®ƒä»¬å°†ä»èŠ‚ç‚¹çš„æ•°æ®éƒ½æ¸…ç©ºäº†ï¼›</p></li></ol><p>å½“ Redis Sentinel ç”¨äºé«˜å¯ç”¨æ€§æ—¶ï¼ŒåŒæ—¶å…³é—­ master ä¸Šçš„æŒä¹…æ€§ä»¥åŠè¿›ç¨‹çš„è‡ªåŠ¨é‡å¯æ˜¯å±é™©çš„ã€‚ä¾‹å¦‚ï¼Œmaster å¯ä»¥è¶³å¤Ÿå¿«åœ°é‡æ–°å¯åŠ¨ï¼Œä»¥ä½¿ Sentinel æ— æ³•æ£€æµ‹åˆ°æ•…éšœï¼Œä»è€Œå‘ç”Ÿä¸Šè¿°æ•…éšœæ¨¡å¼ã€‚</p></div><!----><!----><!--[--><h2 id="doc-contributors" tabindex="-1"><a href="#doc-contributors" class="header-anchor"><span>Contributors</span></a></h2><div class="vp-contributors"><span target="_blank" rel="noreferrer" class="vp-contributor"><!----><span class="vp-contributor-name">Dylan Kwok</span></span></div><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/guosgbin/vuepress-blog/edit/main/src/Redis/Rediså¤åˆ¶.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank" iconsizing="both"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last Updated:</span><time class="vp-meta-info" datetime="2025-04-03T07:07:29.000Z" data-allow-mismatch>4/3/25, 7:07 AM</time></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/Redis/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.html" aria-label="Rediså‘å¸ƒè®¢é˜…" iconsizing="both"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->Rediså‘å¸ƒè®¢é˜…</div></a><a class="route-link auto-link next" href="/Redis/Redis%E5%A4%A7key%E5%92%8C%E7%83%ADkey%E9%97%AE%E9%A2%98.html" aria-label="Rediså¤§keyå’Œçƒ­keyé—®é¢˜" iconsizing="both"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Rediså¤§keyå’Œçƒ­keyé—®é¢˜<!----></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div style="display: flex;
align-items: center;
justify-content: center;
height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);
--icon-size: 48px;
display: inline-block;
width: var(--icon-size);
height: var(--icon-size);
background-color: currentcolor;
-webkit-mask-image: var(--loading-icon);
mask-image: var(--loading-icon);
"></span></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">Default footer</div><div class="vp-copyright">Copyright Â© 2025 è¶…å¨è“çŒ« Dylan Kwok </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DePq4ozi.js" defer></script>
  </body>
</html>
